<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TDS - Tools for Data Science</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4c2882;
            --primary-light: #6b3eb6;
            --secondary-color: #37bb9c;
            --dark-color: #2c2c2c;
            --light-color: #f5f5f5;
            --success-color: #4CAF50;
            --error-color: #f44336;
            --warning-color: #ff9800;
            --text-color: #333;
            --border-radius: 8px;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light-color);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            color: white;
            padding: 25px;
            margin-bottom: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }
        
        /* Mobile responsive header */
        @media (max-width: 768px) {
            header {
                padding: 15px;
                margin-bottom: 15px;
            }
        }
        
        @media (max-width: 480px) {
            header {
                padding: 12px;
                margin-bottom: 10px;
                border-radius: 8px;
            }
        }
        
        header::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background: radial-gradient(circle at top right, rgba(255,255,255,0.2), transparent);
            pointer-events: none;
        }
        
        h1 {
            margin: 0;
            font-size: 32px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }
        
        /* Mobile responsive h1 */
        @media (max-width: 768px) {
            h1 {
                font-size: 24px;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 20px;
            }
        }
        
        .subtitle {
            font-style: italic;
            opacity: 0.9;
            margin-top: 10px;
            font-weight: 300;
        }
        
        .header-buttons {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
        
        /* Mobile responsive header buttons */
        @media (max-width: 768px) {
            .header-buttons {
                position: relative;
                top: auto;
                right: auto;
                margin-top: 15px;
                justify-content: center;
                flex-wrap: wrap;
                gap: 8px;
            }
        }
        
        @media (max-width: 480px) {
            .header-buttons {
                margin-top: 10px;
                gap: 6px;
            }
        }
        
        .header-button {
            background-color: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* Mobile responsive header button */
        @media (max-width: 768px) {
            .header-button {
                padding: 6px 12px;
                font-size: 12px;
                border-radius: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .header-button {
                padding: 5px 10px;
                font-size: 11px;
                border-radius: 12px;
            }
        }
        
        .header-button:hover {
            background-color: rgba(255,255,255,0.3);
        }
        
        .main-section {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .chat-container {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 600px;
        }
        
        .chat-box {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
            background-color: white;
        }
        
        .message {
            padding: 12px 18px;
            border-radius: 18px;
            margin-bottom: 15px;
            max-width: 85%;
            word-wrap: break-word;
            position: relative;
            animation: fadeIn 0.3s ease;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            background-color: #e3f2fd;
            margin-left: auto;
            border-top-right-radius: 4px;
            text-align: right;
        }
        
        .bot-message {
            background-color: #f5f5f5;
            margin-right: auto;
            border-top-left-radius: 4px;
            white-space: pre-wrap;
        }
        
        .bot-message.loading {
            background-color: #f0f0f0;
            color: #666;
        }
        
        .bot-message.loading::after {
            content: '‚è≥';
            margin-left: 5px;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }
        
        .input-area {
            padding: 15px;
            background-color: #f9f9f9;
            border-top: 1px solid #eee;
        }
        
        .input-form {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        /* Mobile responsive input form */
        @media (max-width: 768px) {
            .input-form {
                flex-direction: column;
                gap: 8px;
                align-items: stretch;
            }
        }
        
        @media (max-width: 480px) {
            .input-form {
                gap: 6px;
            }
        }

        /* File Repository Section */
        .file-repository-section {
            margin: 40px 0;
            background: var(--surface-color);
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            border: 2px solid #f0f0f0;
            z-index: 1;
            position: relative;
        }

        .repository-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: 600;
        }

        .repository-header i {
            margin-right: 10px;
        }

        .toggle-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 5px;
            color: white;
            padding: 5px 10px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .toggle-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .repository-content {
            padding: 20px;
            max-height: 600px;
            overflow-y: auto;
        }

        .file-upload-area {
            margin-bottom: 20px;
            padding: 15px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            text-align: center;
        }

        .upload-container {
            margin-bottom: 15px;
        }

        .file-upload-btn {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .file-upload-btn:hover {
            transform: translateY(-2px);
        }

        .file-upload-btn i {
            margin-right: 8px;
        }

        .file-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }

        .file-item .file-info {
            display: flex;
            align-items: center;
        }

        .file-item .file-info i {
            margin-right: 8px;
            color: #667eea;
        }

        .ga-categories {
            border-top: 1px solid #eee;
            padding-top: 20px;
        }

        .category-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .category-tab {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 20px;
            padding: 8px 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .category-tab:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .category-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .questions-container {
            max-height: 400px;
            overflow-y: auto;
        }

        .question-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            cursor: pointer;
            transition: all 0.3s;
        }

        .question-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .question-item .file-path {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
            font-family: 'Courier New', monospace;
        }

        .question-item .question-text {
            color: #333;
            line-height: 1.5;
        }

        /* Mobile Responsive for File Repository */
        @media (max-width: 768px) {
            .file-repository-section {
                margin: 30px 0;
                border: 1px solid #e0e0e0;
            }
            
            .repository-content {
                padding: 15px;
                max-height: 500px;
            }

            .category-tabs {
                justify-content: center;
            }

            .category-tab {
                font-size: 14px;
                padding: 6px 12px;
            }

            .file-upload-btn {
                width: 100%;
                padding: 12px;
            }

            .question-item {
                padding: 12px;
            }

            .question-item .file-path {
                font-size: 11px;
            }
        }

        @media (max-width: 480px) {
            .file-repository-section {
                margin: 25px 0;
                border-radius: 5px;
            }
            
            .repository-header {
                padding: 12px 15px;
                font-size: 14px;
            }

            .category-tabs {
                flex-direction: column;
                align-items: stretch;
            }

            .category-tab {
                text-align: center;
                margin-bottom: 5px;
            }
        }

                .base64-decoder-section {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .decoder-header {
            padding: 15px;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            position: relative;
        }
        
        .decoder-content {
            padding: 15px;
        }
        
        .decoder-textarea {
            width: 100%;
            min-height: 70px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-family: monospace;
            font-size: 13px;
            resize: vertical;
        }
        
        .image-preview {
            margin-top: 15px;
            border: 1px solid #eee;
            border-radius: var(--border-radius);
            padding: 15px;
        }
        
        .preview-container {
            margin: 10px 0;
            text-align: center;
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: var(--border-radius);
        }
        
        #previewImage {
            max-width: 100%;
            max-height: 300px;
            border: 1px solid #ddd;
        }
        
        .image-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: var(--transition);
        }
        
        .action-btn:hover {
            background-color: var(--primary-light);
        }
        
        .action-btn.secondary {
            background-color: var(--secondary-color);
        }
        
        .action-btn.secondary:hover {
            background-color: #2ea58a;
        }
        
        .action-btn.clear {
            background-color: #6c757d;
        }
        
        .action-btn.clear:hover {
            background-color: #5a6268;
        }
        
        .encoder-section {
            margin-top: 15px;
            border-top: 1px solid #eee;
            padding-top: 15px;
            display: flex;
            justify-content: center;
        }
        
        .file-upload-btn {
            display: inline-block;
            background-color: var(--secondary-color);
            color: white;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .file-upload-btn:hover {
            background-color: #2ea58a;
        }
        
        .usage-badge {
            position: absolute;
            right: 15px;
            background-color: rgba(0,0,0,0.2);
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: normal;
        }
        
        .question-input {
            flex-grow: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 16px;
            background-color: white;
            transition: var(--transition);
        }
        
        /* Mobile responsive question input */
        @media (max-width: 768px) {
            .question-input {
                padding: 10px 12px;
                font-size: 16px; /* Prevent zoom on iOS */
                border-radius: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .question-input {
                padding: 8px 10px;
                border-radius: 12px;
            }
        }
        
        .question-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(76, 40, 130, 0.1);
        }
        
        .file-attach {
            position: relative;
        }
        
        .file-attach input[type="file"] {
            position: absolute;
            width: 0.1px;
            height: 0.1px;
            opacity: 0;
            overflow: hidden;
            z-index: -1;
        }
        
        .file-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: var(--secondary-color);
            color: white;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .file-button:hover {
            background-color: #2ea58a;
        }
        
        .send-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            transition: var(--transition);
        }
        
        /* Mobile responsive send button */
        @media (max-width: 768px) {
            .send-button {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
        }
        
        @media (max-width: 480px) {
            .send-button {
                width: 32px;
                height: 32px;
                font-size: 14px;
            }
        }
        
        .send-button:hover {
            background-color: var(--primary-light);
        }
        
        .sidebar {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 600px;
            max-height: 600px;
        }
        
        .sidebar-header {
            padding: 15px;
            background-color: var(--primary-color);
            color: white;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .question-categories {
            display: flex;
            border-bottom: 1px solid #eee;
            flex-shrink: 0;
        }
        
        .category-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            transition: var(--transition);
        }
        
        .category-tab.active {
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        .preloaded-questions {
            flex-grow: 1;
            overflow-y: auto;
            padding: 10px;
            max-height: calc(600px - 120px); /* Subtract header and tabs height */
        }
        
        .question-content {
            width: 100%;
        }
        
        .question-file-path {
            font-size: 11px;
            color: #666;
            margin-bottom: 5px;
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
            display: inline-block;
        }
        
        .question-text {
            line-height: 1.4;
            color: #333;
        }
        
        .loading, .notice {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
        }
        
        .file-categories {
            flex-shrink: 0;
            border-bottom: 1px solid #eee;
        }
        
        .file-questions {
            flex-grow: 1;
            overflow-y: auto;
            padding: 10px;
            max-height: calc(600px - 120px); /* Subtract header height */
        }
        
        .question-item {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: var(--transition);
            word-wrap: break-word;
            line-height: 1.4;
        }
        
        .question-item:hover {
            background-color: #f5f5f5;
        }
        
        .question-item:last-child {
            border-bottom: none;
        }
        
        /* Right sidebar containing both questions and file upload */
        .right-sidebar {
            background: white;
            border-radius: 12px;
            padding: 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            height: 700px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        /* File Repository Section (now separate from right-sidebar) */
        .file-repository-section {
            margin-top: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .file-repository-section .file-upload-header {
            padding: 16px;
            background: var(--primary-color);
            color: white;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .file-repository-section .file-upload-content {
            padding: 20px;
        }

        .file-repository-section .file-input-container {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-bottom: 20px;
        }

        .file-repository-section .file-input {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            background: white;
        }

        .file-repository-section .upload-button {
            padding: 10px 20px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .file-repository-section .upload-button:hover {
            background: var(--primary-light);
            transform: translateY(-1px);
        }

        .file-repository-section .uploaded-files {
            border-top: 1px solid #e9ecef;
            padding-top: 20px;
        }

        .file-repository-section .uploaded-files h4 {
            margin: 0 0 15px 0;
            color: var(--primary-color);
            font-size: 16px;
            font-weight: 600;
        }

        .file-repository-section .uploaded-files ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .file-repository-section .uploaded-files li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .file-repository-section .uploaded-files li:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .file-repository-section .uploaded-files li:last-child {
            margin-bottom: 0;
        }

        .file-repository-section .uploaded-files li span {
            flex: 1;
            font-weight: 500;
            color: #2c3e50;
        }

        .file-repository-section .uploaded-files li div {
            display: flex;
            gap: 10px;
        }

        .file-repository-section .uploaded-files a {
            padding: 6px 15px;
            text-decoration: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .file-repository-section .uploaded-files a[href*="use-file"] {
            background: #28a745;
            color: white;
        }

        .file-repository-section .uploaded-files a[href*="use-file"]:hover {
            background: #1e7e34;
        }

        .file-repository-section .delete-link {
            background: #dc3545 !important;
            color: white !important;
        }

        .file-repository-section .delete-link:hover {
            background: #c82333 !important;
        }

        /* File-based questions improvements */
        .file-categories {
            padding: 16px;
            border-bottom: 1px solid #e9ecef;
            max-height: 200px;
            overflow-y: auto;
        }

        .file-category-item {
            padding: 12px 16px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .file-category-item:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .file-category-item.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .file-questions {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            max-height: 400px;
        }

        .file-questions .question-item {
            margin-bottom: 12px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
            cursor: pointer;
            transition: all 0.3s ease;
            line-height: 1.6;
            font-size: 14px;
        }

        .file-questions .question-item:hover {
            background: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .file-questions .question-item:last-child {
            margin-bottom: 0;
        }

        /* Update right-sidebar to focus only on questions */
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #e9ecef;
            margin-top: auto; /* Push to bottom of right-sidebar */
        }
        
        .file-upload-header {
            padding: 15px;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .file-upload-content {
            padding: 20px;
        }
        
        .file-input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .file-input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            background-color: white;
        }
        
        .upload-button {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .upload-button:hover {
            background-color: var(--primary-light);
        }
        
        .uploaded-files h4 {
            margin-top: 0;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .uploaded-files ul {
            list-style: none;
            padding: 0;
        }
        
        .uploaded-files li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .uploaded-files li:last-child {
            border-bottom: none;
        }
        
        .uploaded-files a {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 14px;
            margin-left: 10px;
        }
        
        .status-bar {
            background-color: var(--primary-color);
            color: white;
            padding: 8px 15px;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 14px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            z-index: 1000;
        }
        .api-status-section {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    margin: 0 15px;
} 
.status-indicator#apiStatus {
    padding: 4px 8px;
    border-radius: 4px;
    margin: 0;
}
status-indicator#apiStatus.status-up {
    background-color: rgba(76, 175, 80, 0.2);
}

.status-indicator#apiStatus.status-down {
    background-color: rgba(244, 67, 54, 0.2);
}

.status-indicator#apiStatus.status-unknown {
    background-color: rgba(255, 152, 0, 0.2);
}

.last-checked {
    font-size: 10px;
    color: rgba(255, 255, 255, 0.7);
    margin-top: 2px;
}

@media (max-width: 768px) {
    .api-status-section {
        margin: 5px 0;
        width: 100%;
    }
}

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            background-color: var(--success-color);
            border-radius: 50%;
        }
        
        code {
            background-color: #f0f0f0;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            color: #e83e8c;
        }
        
        pre {
            background-color: #f8f8f8;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border: 1px solid #eee;
            margin: 10px 0;
        }
        
        .code-block {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            margin: 10px 0;
            position: relative;
        }
        
        .code-block::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
        }
        
        .copy-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #ddd;
            border-radius: 3px;
            padding: 3px 8px;
            font-size: 12px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .copy-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        @media (max-width: 900px) {
            .main-section {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .sidebar {
                height: 300px;
            }
            
            .status-bar {
                flex-direction: column;
                gap: 5px;
                padding: 5px;
            }
        }
        
        /* Additional mobile responsiveness */
        @media (max-width: 768px) {
            .main-section {
                gap: 10px;
            }
            
            .sidebar {
                height: 250px;
            }
            
            .chat-container {
                border-radius: 8px;
            }
        }
        
        @media (max-width: 480px) {
            .main-section {
                gap: 8px;
            }
            
            .sidebar {
                height: 200px;
            }
            
            .chat-container,
            .sidebar {
                border-radius: 6px;
            }
        }
        /* Add to your existing CSS in the style section */
.question-type-selector {
    margin-bottom: 15px;
    display: flex;
    gap: 10px;
}
        .html-viewer-section {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-top: 20px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .viewer-header {
            padding: 15px;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            position: relative;
        }
        
        .viewer-content {
            padding: 15px;
        }
        
        .url-input-container {
            display: flex;
            gap: 10px;
        }
        
        .url-input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-family: inherit;
        }
        
        .html-preview {
            margin-top: 15px;
            border: 1px solid #eee;
            border-radius: var(--border-radius);
            padding: 15px;
        }
        
        #previewFrame {
            width: 100%;
            height: 400px;
            border: 1px solid #ddd;
            background-color: white;
            border-radius: var(--border-radius);
        }
        
        .viewer-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .source-view {
            width: 100%;
            height: 200px;
            overflow: auto;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            margin-top: 10px;
            white-space: pre-wrap;
            display: none;
        }
.file-questions {
    flex-grow: 1;
    overflow-y: auto;
    padding: 10px;
    max-height: calc(100% - 100px); /* Adjust based on header and categories height */
    display: flex;
    flex-direction: column;
}

/* Optional: Add some styling for the notice message when no questions are found */
.file-questions .notice {
    padding: 15px;
    text-align: center;
    color: #666;
    font-style: italic;
}
.question-type-btn {
    padding: 8px 15px;
    background-color: #f0f0f0;
    border: 1px solid #ddd;
    border-radius: 20px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: var(--transition);
}

.question-type-btn.active {
    background-color: var(--primary-color);
    color: white;
}

.file-categories {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    padding: 10px;
    border-bottom: 1px solid #eee;
}

.file-category {
    padding: 5px 10px;
    background-color: #f0f0f0;
    border-radius: 15px;
    cursor: pointer;
    font-size: 13px;
    transition: var(--transition);
}

.file-category.active {
    background-color: var(--primary-color);
    color: white;
}

.file-question-item {
    padding: 12px 15px;
    border-bottom: 1px solid #eee;
    position: relative;
}

.file-question-item:last-child {
    border-bottom: none;
}

.question-text {
    margin-bottom: 8px;
}

.question-file-path {
    font-size: 12px;
    color: #888;
    font-style: italic;
}

.ask-button {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    background-color: var(--primary-color);
    color: white;
    border: none;
    border-radius: 4px;
    padding: 4px 8px;
    font-size: 12px;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.file-question-item:hover .ask-button {
    opacity: 1;
}
/* Feedback Button */
.feedback-btn {
    position: fixed;
    bottom: 70px;
    right: 20px;
    background-color: var(--primary-color);
    color: white;
    border: none;
    border-radius: 30px;
    padding: 10px 20px;
    cursor: pointer;
    box-shadow: var(--shadow);
    z-index: 999;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: var(--transition);
}

.feedback-btn:hover {
    background-color: var(--primary-light);
    transform: scale(1.05);
}

/* Feedback Dialog and Form Common Styles */
.feedback-dialog,
.feedback-form,
.feedback-success {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    border-radius: var(--border-radius);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    z-index: 1001;
    display: none;
    max-width: 90%;
}

.feedback-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    display: none;
}

/* Initial Dialog */
.feedback-dialog {
    width: 400px;
}

.feedback-dialog-content {
    padding: 25px;
}

.feedback-dialog h3 {
    color: var(--primary-color);
    margin-bottom: 15px;
}

.feedback-dialog p {
    margin-bottom: 20px;
}

.feedback-dialog-buttons {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
}

/* Feedback Form */
.feedback-form {
    width: 500px;
}

.feedback-form-header {
    padding: 15px 25px;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.close-btn {
    background: transparent;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #888;
}

.close-btn:hover {
    color: var(--error-color);
}

.feedback-form-body {
    padding: 20px 25px;
    max-height: 60vh;
    overflow-y: auto;
}

.feedback-form-footer {
    padding: 15px 25px;
    border-top: 1px solid #eee;
    text-align: right;
}

.form-group {
    margin-bottom: 15px;
}

label {
    display: block;
    margin-bottom: 5px;
    font-weight: 500;
}

/* Success Message */
.feedback-success {
    width: 400px;
    text-align: center;
}

.feedback-success-content {
    padding: 30px;
}

.feedback-success i {
    font-size: 50px;
    color: var(--success-color);
    margin-bottom: 15px;
}

.feedback-success h3 {
    color: var(--primary-color);
    margin-bottom: 15px;
}

.feedback-success p {
    margin-bottom: 20px;
}
/* Video Transcription Styles */
.video-transcription-section {
    background-color: white;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    margin-top: 20px;
    margin-bottom: 20px;
    overflow: hidden;
}

.transcription-header {
    padding: 15px;
    background-color: var(--primary-color);
    color: white;
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: bold;
    position: relative;
}

.transcription-content {
    padding: 15px;
}

.transcription-tabs, .result-tabs {
    display: flex;
    border-bottom: 1px solid #eee;
    margin-bottom: 15px;
}

.transcription-tab, .result-tab {
    padding: 8px 16px;
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: var(--transition);
}

.transcription-tab.active, .result-tab.active {
    border-bottom-color: var(--primary-color);
    color: var(--primary-color);
}

.transcription-tab-content {
    display: none;
    margin-bottom: 15px;
}

.transcription-tab-content.active {
    display: block;
}

.time-inputs {
    display: flex;
    gap: 10px;
}

.time-input {
    flex: 1;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: var(--border-radius);
}

.form-input {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: var(--border-radius);
    margin-bottom: 10px;
}

.checkboxes {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    margin: 15px 0;
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 5px;
    cursor: pointer;
}

.transcription-results {
    margin-top: 20px;
    border-top: 1px solid #eee;
    padding-top: 15px;
}

.result-container {
    display: none;
    margin-bottom: 15px;
}

.result-container.active {
    display: block;
}

.transcript-text {
    max-height: 300px;
    overflow-y: auto;
    padding: 15px;
    background-color: #f5f5f5;
    border-radius: var(--border-radius);
    white-space: pre-wrap;
    margin-bottom: 15px;
    font-size: 14px;
    line-height: 1.6;
}

.audio-player {
    margin-bottom: 15px;
}

.audio-player audio {
    width: 100%;
}

.transcription-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.loading-indicator {
    text-align: center;
    padding: 20px;
    display: none;
}

.loading-indicator i {
    animation: spin 1s linear infinite;
    font-size: 24px;
    color: var(--primary-color);
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
/* Mobile Styles */
@media (max-width: 576px) {
    .feedback-dialog,
    .feedback-form,
    .feedback-success {
        width: 90%;
    }
    
    .feedback-btn {
        padding: 8px 15px;
        font-size: 14px;
    }
}

/* Gemini Chatbot Styles */
/* Enhanced Gemini Chatbot Styles */
.gemini-chatbot {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 1000;
}

.chatbot-trigger {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: linear-gradient(135deg, #4285f4, #34a853);
    color: white;
    border: none;
    cursor: pointer;
    font-size: 24px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

.chatbot-trigger:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
}

.chatbot-window {
    position: fixed;
    bottom: 90px;
    right: 20px;
    width: 400px;
    height: 600px;
    background: white;
    border-radius: 15px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    display: none;
    flex-direction: column;
    overflow: hidden;
    z-index: 1001;
}

.chatbot-header {
    background: linear-gradient(135deg, #4285f4, #34a853);
    color: white;
    padding: 15px;
    font-weight: bold;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.chatbot-close {
    background: none;
    border: none;
    color: white;
    font-size: 20px;
    cursor: pointer;
}

.gemini-chat-area {
    flex: 1;
    overflow-y: auto;
    padding: 15px;
    background: #f8f9fa;
}

.gemini-message {
    margin-bottom: 15px;
    padding: 12px 16px;
    border-radius: 18px;
    max-width: 85%;
    word-wrap: break-word;
    animation: fadeInUp 0.3s ease;
    line-height: 1.5;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.gemini-user-message {
    background: linear-gradient(135deg, #007bff, #0056b3);
    color: white;
    margin-left: auto;
    border-bottom-right-radius: 4px;
}

.gemini-ai-message {
    background: white;
    color: #333;
    margin-right: auto;
    border-bottom-left-radius: 4px;
    border: 1px solid #e0e0e0;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.gemini-ai-message.formatted {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

.gemini-ai-message.formatted p {
    margin: 0 0 12px 0;
}

.gemini-ai-message.formatted p:last-child {
    margin-bottom: 0;
}

.gemini-ai-message.formatted strong {
    color: #2c3e50;
    font-weight: 600;
}

.gemini-ai-message.formatted em {
    color: #34495e;
    font-style: italic;
}

.gemini-ai-message.formatted .code-block {
    background: #2d3748;
    color: #e2e8f0;
    padding: 12px;
    border-radius: 8px;
    margin: 10px 0;
    font-family: 'Fira Code', 'Monaco', 'Consolas', monospace;
    font-size: 13px;
    overflow-x: auto;
    position: relative;
}

.gemini-ai-message.formatted .inline-code {
    background: #f1f3f4;
    color: #d73a49;
    padding: 2px 6px;
    border-radius: 4px;
    font-family: 'Monaco', 'Consolas', monospace;
    font-size: 12px;
}

.gemini-ai-message.formatted .list-item {
    margin: 8px 0;
    padding-left: 16px;
}

.gemini-ai-message.formatted .list-item.numbered {
    counter-increment: list-counter;
}

.gemini-ai-message.formatted .list-item.numbered::before {
    content: counter(list-counter) ". ";
    font-weight: bold;
    color: #4285f4;
}

.gemini-ai-message.formatted .list-item.bullet {
    color: #4285f4;
}

.copy-code-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 11px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.copy-code-btn:hover {
    background: rgba(255, 255, 255, 0.2);
}

.gemini-input-area {
    padding: 15px;
    border-top: 1px solid #e0e0e0;
    background: white;
}

.gemini-input-form {
    display: flex;
    gap: 10px;
}

.gemini-input {
    flex: 1;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 20px;
    outline: none;
    font-size: 14px;
    transition: border-color 0.2s ease;
}

.gemini-input:focus {
    border-color: #4285f4;
    box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.1);
}

.gemini-send-btn {
    padding: 12px 16px;
    background: linear-gradient(135deg, #4285f4, #34a853);
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s ease;
}

.gemini-send-btn:hover {
    transform: scale(1.05);
}

// Replace the existing no-match alert styles in the <style> section with this enhanced version:

/* Enhanced No Match Alert with Animation */
.no-match-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.6);
    z-index: 1000;
    display: none;
    backdrop-filter: blur(5px);
    animation: fadeIn 0.3s ease;
}

.no-match-alert {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: linear-gradient(135deg, #ffffff, #f8f9fa);
    border-radius: 20px;
    padding: 40px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    z-index: 1002;
    max-width: 500px;
    width: 90%;
    text-align: center;
    display: none;
    border: 2px solid #e9ecef;
    animation: slideInScale 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

@keyframes slideInScale {
    0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.7) translateY(20px);
    }
    100% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1) translateY(0);
    }
}

.alert-icon {
    font-size: 48px;
    margin-bottom: 20px;
    animation: bounce 2s infinite;
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% {
        transform: translateY(0);
    }
    40% {
        transform: translateY(-10px);
    }
    60% {
        transform: translateY(-5px);
    }
}

.alert-title {
    font-size: 24px;
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 15px;
}

.alert-message {
    font-size: 16px;
    color: #666;
    margin-bottom: 25px;
    line-height: 1.6;
}

/* Enhanced Countdown Timer */
.countdown-container {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 15px;
    border-radius: 15px;
    margin: 20px 0;
    position: relative;
    overflow: hidden;
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
}

.countdown-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    animation: shimmer 2s infinite;
}

@keyframes shimmer {
    0% { left: -100%; }
    100% { left: 100%; }
}

.countdown-text {
    font-size: 14px;
    margin-bottom: 8px;
    opacity: 0.9;
}

.countdown-timer {
    font-size: 32px;
    font-weight: 700;
    font-family: 'Courier New', monospace;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    animation: pulse 1s ease-in-out infinite alternate;
}

@keyframes pulse {
    0% { transform: scale(1); }
    100% { transform: scale(1.05); }
}

.countdown-progress {
    width: 100%;
    height: 6px;
    background: rgba(255,255,255,0.3);
    border-radius: 3px;
    margin-top: 10px;
    overflow: hidden;
}

.countdown-progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #ff6b6b, #feca57, #48dbfb);
    border-radius: 3px;
    transition: width 0.1s ease;
    animation: progressGlow 1s ease-in-out infinite alternate;
}

@keyframes progressGlow {
    0% { box-shadow: 0 0 5px rgba(255,255,255,0.5); }
    100% { box-shadow: 0 0 15px rgba(255,255,255,0.8); }
}

.alert-buttons {
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 25px;
}

.alert-btn {
    padding: 12px 24px;
    border: none;
    border-radius: 25px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    min-width: 120px;
}

.alert-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s ease;
}

.alert-btn:hover::before {
    left: 100%;
}

.alert-btn-primary {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
}

.alert-btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
}

.alert-btn-secondary {
    background: linear-gradient(135deg, #4285f4, #34a853);
    color: white;
    box-shadow: 0 4px 15px rgba(66, 133, 244, 0.4);
}

.alert-btn-secondary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(66, 133, 244, 0.6);
}

.alert-btn-tertiary {
    background: linear-gradient(135deg, #ff9a9e, #fecfef);
    color: #2c3e50;
    box-shadow: 0 4px 15px rgba(255, 154, 158, 0.4);
}

.alert-btn-tertiary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(255, 154, 158, 0.6);
}

@media (max-width: 768px) {
    .no-match-alert {
        padding: 30px 20px;
        margin: 0 10px;
    }
    
    .alert-buttons {
        flex-direction: column;
    }
    
    .alert-btn {
        width: 100%;
        margin: 5px 0;
    }
    
    .countdown-timer {
        font-size: 28px;
    }
}

/* Replace the debug section styles with these: */

/* Tools Section Container */
.tools-section-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 20px;
    margin-bottom: 20px;
}

/* Debug Section Styles */
.debug-section {
    background-color: white;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    overflow: hidden;
}

.debug-header {
    padding: 15px;
    background-color: #e74c3c;
    color: white;
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: bold;
    position: relative;
}

.debug-content {
    padding: 15px;
}

.debug-btn {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 25px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
    width: 100%;
    justify-content: center;
}

.debug-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(231, 76, 60, 0.4);
}

/* Debug Expandable Area */
.debug-expandable {
    margin-top: 15px;
    border-top: 1px solid #eee;
    padding-top: 15px;
    animation: slideDown 0.3s ease;
}

@keyframes slideDown {
    from {
        opacity: 0;
        max-height: 0;
        padding-top: 0;
    }
    to {
        opacity: 1;
        max-height: 500px;
        padding-top: 15px;
    }
}

.debug-actions {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
    flex-wrap: wrap;
}

.debug-action-btn {
    flex: 1;
    padding: 8px 12px;
    background: #e74c3c;
    color: white;
    border: none;
    border-radius: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 5px;
    font-size: 13px;
    transition: var(--transition);
    min-width: 90px;
}

.debug-action-btn:hover {
    background: #c0392b;
}

.debug-action-btn.secondary {
    background: #3498db;
}

.debug-action-btn.secondary:hover {
    background: #2980b9;
}

.debug-action-btn.tertiary {
    background: #95a5a6;
}

.debug-action-btn.tertiary:hover {
    background: #7f8c8d;
}

.debug-output {
    background: #f8f9fa;
    border-radius: var(--border-radius);
    padding: 15px;
    max-height: 300px;
    overflow-y: auto;
    border: 1px solid #dee2e6;
}

.debug-message {
    margin-bottom: 10px;
    padding: 8px 12px;
    border-radius: 8px;
    background: white;
    border-left: 4px solid #e74c3c;
    font-size: 14px;
    line-height: 1.4;
}

.debug-message.success {
    border-left-color: #28a745;
    background: #d4edda;
}

.debug-message.error {
    border-left-color: #dc3545;
    background: #f8d7da;
}

.debug-message.info {
    border-left-color: #17a2b8;
    background: #d1ecf1;
}

.debug-message.question {
    border-left-color: #6f42c1;
    background: #e2d9f3;
}

.debug-message pre {
    background: #2d2d2d;
    color: #f8f8f2;
    padding: 10px;
    border-radius: 4px;
    overflow-x: auto;
    font-size: 12px;
    margin: 5px 0;
}

@media (max-width: 768px) {
    .tools-section-container {
        grid-template-columns: 1fr;
    }
    
    .debug-actions {
        flex-direction: column;
    }
    
    .debug-action-btn {
        min-width: auto;
    }
}

/* ===== COMPREHENSIVE MOBILE RESPONSIVE ENHANCEMENTS ===== */

/* Enhanced container responsiveness */
@media (max-width: 1200px) {
    .container {
        max-width: 95%;
        padding: 15px;
    }
}

/* Tablet optimizations */
@media (max-width: 1024px) {
    .container {
        padding: 12px;
    }
    
    .main-section {
        grid-template-columns: 1fr;
        gap: 15px;
        height: auto;
        min-height: calc(100vh - 80px);
    }
    
    .right-sidebar {
        order: -1;
        max-width: 100%;
        height: auto;
        min-height: 300px;
        flex-direction: row;
        gap: 15px;
        overflow-x: auto;
    }
    
    .sidebar {
        flex: 1;
        min-width: 250px;
    }
    
    .file-upload-section {
        flex: 0 0 250px;
        margin-top: 0;
    }
    
    .chat-container {
        order: 1;
        min-height: 400px;
    }
    
    /* File repository now separate below chat */
    .file-repository-section {
        order: 2;
        margin-top: 15px;
    }
    
    .chat-messages {
        max-height: 400px;
    }
}

/* Mobile landscape optimizations */
@media (max-width: 900px) and (orientation: landscape) {
    .main-section {
        grid-template-columns: 2fr 1fr;
        height: 85vh;
    }
    
    .chat-container {
        height: 100%;
    }
    
    .right-sidebar {
        height: 100%;
        flex-direction: column;
        gap: 10px;
    }
    
    .sidebar {
        height: auto;
        min-height: 250px;
    }
}

/* Mobile portrait - stack layout */
@media (max-width: 900px) and (orientation: portrait) {
    .main-section {
        grid-template-columns: 1fr;
        gap: 15px;
        height: auto;
    }
    
    .chat-container {
        order: 1;
    }
    
    .file-repository-section {
        order: 2;
        margin-top: 15px;
    }
    
    .right-sidebar {
        order: 3;
        flex-direction: column;
        height: auto;
        min-height: 400px;
        gap: 15px;
        overflow-x: visible;
        overflow-y: auto;
    }
    
    .sidebar {
        min-width: auto;
        height: auto;
    }
}

/* Enhanced mobile portrait optimizations */
@media (max-width: 768px) {
    body {
        font-size: 14px;
    }
    
    .container {
        padding: 8px;
    }
    
    /* Chat optimizations */
    .chat-messages {
        max-height: 350px;
        padding: 10px;
    }
    
    .message {
        padding: 8px 12px;
        margin-bottom: 8px;
        border-radius: 12px;
    }
    
    .message.user {
        margin-left: 20px;
    }
    
    .message.bot {
        margin-right: 20px;
    }
    
    /* Form optimizations */
    .file-attach {
        width: 35px;
        height: 35px;
    }
    
    .file-attach input[type="file"] {
        width: 35px;
        height: 35px;
    }
    
    /* Sidebar optimizations */
    .sidebar-header {
        padding: 12px;
        font-size: 14px;
    }
    
    .category-tab {
        padding: 8px;
        font-size: 13px;
    }
    
    .preloaded-questions {
        padding: 8px;
    }
    
    .question-item {
        padding: 8px;
        font-size: 13px;
        line-height: 1.4;
    }
    
    /* File upload section optimizations */
    .right-sidebar {
        margin-top: 10px;
        height: auto;
        min-height: 350px;
    }
    
    .file-upload-section {
        margin-top: 0;
    }
    
    .file-upload-header {
        padding: 12px;
        font-size: 14px;
    }
    
    .file-upload-content {
        padding: 10px;
    }
    
    /* Tools section optimizations */
    .tools-section-container {
        grid-template-columns: 1fr;
        gap: 15px;
        margin: 15px 0;
    }
    
    /* API docs optimizations */
    .nav-tabs {
        flex-wrap: wrap;
        gap: 5px;
        margin: 20px 0 15px;
    }
    
    .nav-tab {
        padding: 6px 12px;
        font-size: 13px;
    }
}

/* Small mobile optimizations */
@media (max-width: 480px) {
    body {
        font-size: 13px;
    }
    
    .container {
        padding: 6px;
    }
    
    /* Header optimizations */
    .subtitle {
        font-size: 13px;
        margin-top: 8px;
    }
    
    /* Chat optimizations */
    .chat-messages {
        max-height: 300px;
        padding: 8px;
    }
    
    .message {
        padding: 6px 10px;
        margin-bottom: 6px;
        border-radius: 10px;
        font-size: 13px;
    }
    
    .message.user {
        margin-left: 15px;
    }
    
    .message.bot {
        margin-right: 15px;
    }
    
    /* Form optimizations */
    .input-container {
        padding: 8px;
    }
    
    .file-attach {
        width: 30px;
        height: 30px;
    }
    
    .file-attach input[type="file"] {
        width: 30px;
        height: 30px;
    }
    
    /* Sidebar optimizations */
    .sidebar {
        height: 180px;
    }
    
    .sidebar-header {
        padding: 10px;
        font-size: 13px;
    }
    
    .category-tab {
        padding: 6px;
        font-size: 12px;
    }
    
    .question-item {
        padding: 6px;
        font-size: 12px;
        line-height: 1.3;
    }
    
    /* File upload optimizations */
    .file-upload-header {
        padding: 10px;
        font-size: 13px;
    }
    
    .file-upload-content {
        padding: 8px;
    }
    
    .upload-button {
        padding: 8px 12px;
        font-size: 12px;
    }
    
    /* Button optimizations */
    .header-button {
        padding: 4px 8px;
        font-size: 10px;
        border-radius: 10px;
    }
    
    /* Code block optimizations */
    .code-block {
        padding: 10px;
        font-size: 12px;
    }
    
    pre {
        padding: 10px;
        font-size: 12px;
    }
    
    /* Status bar optimizations */
    .status-bar {
        padding: 4px;
        font-size: 11px;
    }
    
    .api-status-item {
        font-size: 10px;
    }
}

/* Extra small mobile optimizations */
@media (max-width: 360px) {
    .container {
        padding: 4px;
    }
    
    h1 {
        font-size: 18px;
    }
    
    .subtitle {
        font-size: 12px;
    }
    
    .chat-messages {
        max-height: 250px;
        padding: 6px;
    }
    
    .message {
        padding: 5px 8px;
        font-size: 12px;
    }
    
    .question-input {
        padding: 6px 8px;
        font-size: 14px;
    }
    
    .send-button {
        width: 28px;
        height: 28px;
        font-size: 12px;
    }
    
    .sidebar {
        height: 150px;
    }
    
    .sidebar-header {
        padding: 8px;
        font-size: 12px;
    }
    
    .category-tab {
        padding: 4px;
        font-size: 11px;
    }
    
    .question-item {
        padding: 4px;
        font-size: 11px;
    }
}

/* Touch optimizations for all mobile devices */
@media (hover: none) and (pointer: coarse) {
    /* Increase touch targets */
    .question-item,
    .category-tab,
    .nav-tab,
    .header-button,
    .send-button,
    .upload-button {
        min-height: 44px;
        min-width: 44px;
    }
    
    /* Improve button feedback */
    .question-item:active,
    .category-tab:active,
    .send-button:active,
    .upload-button:active {
        transform: scale(0.98);
        opacity: 0.8;
    }
    
    /* Remove hover effects that don't work on touch */
    .question-item:hover,
    .category-tab:hover,
    .send-button:hover {
        transform: none;
    }
}

/* High DPI display optimizations */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    .container {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }
}

/* Landscape mobile specific adjustments */
@media (max-width: 768px) and (orientation: landscape) {
    .chat-messages {
        max-height: 200px;
    }
    
    .sidebar {
        height: 200px;
    }
    
    .main-section {
        height: 90vh;
    }
}

/* Mobile layout order fixes */
@media (max-width: 768px) {
    .main-section {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }
    
    .chat-container {
        order: 1;
        width: 100%;
        min-height: 400px;
    }
    
    .right-sidebar {
        order: 2;
        width: 100%;
        min-height: 300px;
        height: auto;
        max-height: none;
        padding: 15px;
        margin-bottom: 20px;
    }
    
    .question-selector-section {
        margin-bottom: 15px;
    }
    
    .file-upload-section {
        margin-top: 15px;
    }
}

/* Right sidebar improvements for desktop */
@media (min-width: 769px) {
    .right-sidebar {
        padding: 20px;
        gap: 20px;
        min-width: 380px;
        width: 100%;
    }
    
    .question-selector-section,
    .file-upload-section {
        background: rgba(248, 249, 250, 0.8);
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 10px;
    }
}

/* ===== END MOBILE RESPONSIVE ENHANCEMENTS ===== */
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>TDS - Tools for Data Science</h1>
            <div class="subtitle">Full support for Graded Assignments 1 to 5 is now available!</div>
            <div class="header-buttons">
                <button class="header-button" onclick="location.href='/files'">
                    <i class="fas fa-file"></i> Files
                </button>
                <button class="header-button" onclick="location.href='/api/docs'">
                    <i class="fas fa-code"></i> API
                </button>
            </div>
        </header>
        
        <div class="main-section">
            <!-- Chat container (left side) -->
            <div class="chat-container">
                <div class="chat-box" id="chatBox">
                    <!-- Initial welcome message -->
                    <div class="message bot-message">
                        <strong>Welcome to TDS - Tools for Data Science!</strong><br><br>
                        I can help you with various data science tasks and questions, including all assignments for GA1 to GA5. 
                        Try asking a question or select one of the preloaded examples from the sidebar.
                    </div>
                </div>
                <div class="input-area">
                    <form class="input-form" id="questionForm" enctype="multipart/form-data" onsubmit="sendQuestionWithFile(event)">
                        <div class="file-attach">
                            <input type="file" id="fileAttachment" name="file">
                            <label for="fileAttachment" class="file-button">
                                <i class="fas fa-paperclip"></i>
                            </label>
                        </div>
                        <input type="text" class="question-input" id="questionInput" placeholder="Ask me anything about data science..." autocomplete="off">
                        <button type="submit" class="send-button">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </form>
                </div>
                
                <!-- File Repository Section (below chat) -->
                <div class="file-repository-section">
                    <div class="file-upload-header">
                        <i class="fas fa-cloud-upload-alt"></i> File Repository
                    </div>
                    <div class="file-upload-content">
                        <form class="file-input-container" action="/upload" method="post" enctype="multipart/form-data">
                            <input type="file" class="file-input" name="file">
                            <button type="submit" class="upload-button">Upload File</button>
                        </form>
                        <div class="uploaded-files">
                            <h4>Uploaded Files</h4>
                            <ul id="uploadedFilesList">
                                {% if files %}
                                    {% for file in files %}
                                        <li>
                                            <span>{{ file }}</span>
                                            <div>
                                                <a href="/use-file/{{ file }}">Use</a>
                                                <a href="/delete-file/{{ file }}" class="delete-link">Delete</a>
                                            </div>
                                        </li>
                                    {% endfor %}
                                {% else %}
                                    <li>No files uploaded yet</li>
                                {% endif %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right side: Questions Sidebar -->
            <div class="right-sidebar">
                <!-- Question type selection -->
                <div class="question-type-selector">
                    <button class="question-type-btn active" data-type="ga">Graded Assignment</button>
                    <button class="question-type-btn" data-type="file">File-Based</button>
                </div>

                <!-- Sidebar content will change based on selection -->
                <div id="gaSidebar" class="sidebar">
                    <div class="sidebar-header">
                        <i class="fas fa-tasks"></i> Graded Assignment Questions
                    </div>
                    <div class="question-categories">
                        <div class="category-tab active" data-category="GA1">GA1</div>
                        <div class="category-tab" data-category="GA2">GA2</div>
                        <div class="category-tab" data-category="GA3">GA3</div>
                        <div class="category-tab" data-category="GA4">GA4</div>
                        <div class="category-tab" data-category="GA5">GA5</div>
                    </div>
                    <div class="preloaded-questions" id="preloadedQuestions">
                        <!-- Questions will be loaded here by JavaScript -->
                    </div>
                </div>

                <div id="fileSidebar" class="sidebar" style="display: none">
                    <!-- This sidebar is now replaced by the File Repository section below -->
                </div>
            </div>
        </div>

        <!-- File Repository Section -->
        <div class="file-repository-section">
            <div class="repository-header">
                <i class="fas fa-folder-open"></i> File Repository
                <button id="toggleFileRepo" class="toggle-btn">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            <div class="repository-content" id="repositoryContent">
                <div class="file-upload-area">
                    <div class="upload-container">
                        <input type="file" id="fileInput" multiple accept=".py,.txt,.csv,.json,.md,.js,.html,.css">
                        <label for="fileInput" class="file-upload-btn">
                            <i class="fas fa-upload"></i> Upload Files
                        </label>
                    </div>
                    <div class="file-list" id="fileList">
                        <!-- Uploaded files will appear here -->
                    </div>
                </div>
                
                <div class="ga-categories">
                    <div class="category-tabs">
                        <button class="category-tab active" data-category="all">All Questions</button>
                        <button class="category-tab" data-category="GA1">GA1</button>
                        <button class="category-tab" data-category="GA2">GA2</button>
                        <button class="category-tab" data-category="GA3">GA3</button>
                        <button class="category-tab" data-category="GA4">GA4</button>
                        <button class="category-tab" data-category="GA5">GA5</button>
                    </div>
                    <div class="questions-container" id="questionsContainer">
                        <!-- Questions will be loaded dynamically here -->
                    </div>
                </div>
            </div>
        </div>

         <!-- Base64 Image Decoder - Always visible -->
            <div class="base64-decoder-section">
                <div class="decoder-header">
                    <i class="fas fa-image"></i> Base64 Image Decoder
                    <div class="usage-badge" id="decoderUsageCount">Used: 0 times</div>
                </div>
                <div class="decoder-content">
                    <div class="form-group">
                        <textarea id="base64Input" class="decoder-textarea" placeholder="Paste base64-encoded image data here (starts with data:image/...)"></textarea>
                    </div>
                    <div class="image-preview" id="imagePreview" style="display:none;">
                        <div class="preview-container">
                            <img id="previewImage" alt="Decoded image">
                        </div>
                        <div class="image-actions">
                            <button id="copyImageBtn" class="action-btn">Copy Data</button>
                            <button id="downloadImageBtn" class="action-btn secondary">Download</button>
                            <button id="clearImageBtn" class="action-btn clear">Clear</button>
                        </div>
                    </div>
                    <div class="encoder-section">
                        <div class="upload-container">
                            <label for="imageFileInput" class="file-upload-btn">
                                <i class="fas fa-upload"></i> Select Image to Encode
                            </label>
                            <input type="file" id="imageFileInput" accept="image/*" style="display:none;">
                        </div>
                    </div>
                </div>
            </div>
           
            <!-- HTML Viewer - Always visible -->
            <div class="html-viewer-section">
                <div class="viewer-header">
                    <i class="fas fa-globe"></i> HTML Viewer
                    <div class="usage-badge" id="viewerUsageCount">Used: 0 times</div>
                </div>
                <div class="viewer-content">
                    <div class="form-group">
                        <div class="url-input-container">
                            <input type="text" id="urlInput" class="url-input" placeholder="Enter website URL (https://example.com)">
                            <button id="fetchUrlBtn" class="action-btn">View</button>
                        </div>
                    </div>
                    <div class="html-preview" id="htmlPreview" style="display:none;">
                        <div class="preview-container">
                            <iframe id="previewFrame" sandbox="allow-scripts"></iframe>
                        </div>
                        <div class="viewer-actions">
                            <button id="copyHtmlBtn" class="action-btn">Copy HTML</button>
                            <button id="viewSourceBtn" class="action-btn secondary">View Source</button>
                            <button id="clearViewerBtn" class="action-btn clear">Clear</button>
                        </div>
                    </div>
                </div>
            </div>
         <!-- Video Transcription Section -->
<div class="video-transcription-section">
    <div class="transcription-header">
        <i class="fas fa-closed-captioning"></i> Video Transcription
        <div class="usage-badge" id="transcriptionUsageCount">Used: 0 times</div>
    </div>
    <div class="transcription-content">
        <div class="transcription-tabs">
            <div class="transcription-tab active" data-tab="url">URL</div>
            <div class="transcription-tab" data-tab="upload">Upload</div>
        </div>
        
        <div class="transcription-tab-content active" id="urlTab">
            <div class="form-group">
                <input type="text" id="videoUrl" class="form-input" placeholder="Enter YouTube or video URL">
            </div>
        </div>
        
        <div class="transcription-tab-content" id="uploadTab">
            <div class="form-group">
                <input type="file" id="videoFile" accept="video/*" class="form-input">
            </div>
        </div>
        
        <div class="transcription-options">
            <div class="form-group">
                <label>Time Range (optional):</label>
                <div class="time-inputs">
                    <input type="number" id="startTime" placeholder="Start (sec)" min="0" class="time-input">
                    <input type="number" id="endTime" placeholder="End (sec)" min="0" class="time-input">
                </div>
            </div>
            
            <div class="form-group checkboxes">
                <label class="checkbox-label">
                    <input type="checkbox" id="correctText"> 
                    Correct punctuation & grammar
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="translateToHindi"> 
                    Translate to Hindi
                </label>
            </div>
            
            <button id="transcribeBtn" class="action-btn">Transcribe Video</button>
        </div>
        
        <div class="transcription-results" style="display:none;">
            <div class="result-tabs">
                <div class="result-tab active" data-result="english">English</div>
                <div class="result-tab" data-result="hindi" style="display:none;">Hindi</div>
            </div>
            
            <div class="result-container active" id="englishResult">
                <div class="transcript-text" id="englishTranscript"></div>
                <div class="audio-player">
                    <audio id="englishAudio" controls></audio>
                </div>
            </div>
            
            <div class="result-container" id="hindiResult">
                <div class="transcript-text" id="hindiTranscript"></div>
                <div class="audio-player">
                    <audio id="hindiAudio" controls></audio>
                </div>
            </div>
            
            <div class="transcription-actions">
                <button id="copyTranscriptBtn" class="action-btn">Copy Text</button>
                <button id="downloadTranscriptBtn" class="action-btn secondary">Download</button>
                <button id="clearTranscriptionBtn" class="action-btn clear">Clear</button>
            </div>
        </div>
    </div>
</div>
<!-- Replace the debug section and file upload section with this: -->

        <!-- Tools Section Container -->
        <div class="tools-section-container">
            <!-- Debug Tools (Left Side) -->
            <div class="debug-section">
                <div class="debug-header">
                    <i class="fas fa-bug"></i> Debug Tools
                    <div class="usage-badge">Developer Tools</div>
                </div>
                <div class="debug-content">
                    <button id="debugFormBtn" class="debug-btn">
                        <i class="fas fa-search"></i> Debug Form Data
                    </button>
                    
                    <!-- Debug Expandable Area -->
                    <div class="debug-expandable" id="debugExpandable" style="display: none;">
                        <div class="debug-actions">
                            <button id="testFormBtn" class="debug-action-btn">
                                <i class="fas fa-play"></i> Test Form
                            </button>
                            <button id="randomQuestionBtn" class="debug-action-btn secondary">
                                <i class="fas fa-random"></i> Random Question
                            </button>
                            <button id="clearDebugBtn" class="debug-action-btn tertiary">
                                <i class="fas fa-trash"></i> Clear
                            </button>
                        </div>
                        
                        <div class="debug-output" id="debugOutput">
                            <div class="debug-message">
                                Click "Test Form" to check form data, "Random Question" to see a sample question, or "Clear" to reset.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

      <div class="status-bar">
        <div class="status-indicator">
            <span class="status-dot"></span>
            <span>System Online</span>
        </div>
        <div class="api-status-section">
            <div class="status-indicator" id="apiStatus">
                <span class="status-dot"></span>
                <span class="status-text">API: CHECKING</span>
            </div>
            <div class="last-checked" id="lastChecked">Last checked: Never</div>
        </div>
        <div>
            <i class="fas fa-server"></i> Full support for GA1-GA5 enabled
        </div>
        <div>
            <i class="fas fa-code"></i> API Ready
        </div>
    </div>

   

<!-- Feedback button (floating in corner) -->
<button id="feedbackBtn" class="feedback-btn">
    <i class="fas fa-comment-dots"></i> Feedback
</button>

<!-- Initial feedback dialog -->
<div id="feedbackDialog" class="feedback-dialog">
    <div class="feedback-dialog-content">
        <h3>Share Your Feedback</h3>
        <p>Would you like to give feedback or suggestions to improve our platform?</p>
        <div class="feedback-dialog-buttons">
            <button id="feedbackYesBtn" class="action-btn">Yes, I'll help</button>
            <button id="feedbackNoBtn" class="action-btn clear">Not now</button>
        </div>
    </div>
</div>

<!-- Feedback form -->
<div id="feedbackForm" class="feedback-form">
    <div class="feedback-form-content">
        <div class="feedback-form-header">
            <h3>Submit Feedback</h3>
            <button id="closeFormBtn" class="close-btn">&times;</button>
        </div>
        <div class="feedback-form-body">
            <div class="form-group">
                <label for="feedbackName">Name (optional)</label>
                <input type="text" id="feedbackName" class="form-input" placeholder="Your name">
            </div>
            <div class="form-group">
                <label for="feedbackEmail">Email (optional)</label>
                <input type="email" id="feedbackEmail" class="form-input" placeholder="Your email">
            </div>
            <div class="form-group">
                <label for="feedbackType">Feedback Type</label>
                <select id="feedbackType" class="form-input">
                    <option value="suggestion">Suggestion</option>
                    <option value="bug">Bug Report</option>
                    <option value="feature">Feature Request</option>
                    <option value="other">Other Feedback</option>
                </select>
            </div>
            <div class="form-group">
                <label for="feedbackText">Your Feedback</label>
                <textarea id="feedbackText" class="form-textarea" rows="5" placeholder="Please share your thoughts, suggestions, or report issues..."></textarea>
            </div>
        </div>
        <div class="feedback-form-footer">
            <button id="submitFeedbackBtn" class="action-btn">Submit Feedback</button>
        </div>
    </div>
</div>

<!-- Feedback success message -->
<div id="feedbackSuccess" class="feedback-success">
    <div class="feedback-success-content">
        <i class="fas fa-check-circle"></i>
        <h3>Thank You!</h3>
        <p>Your feedback has been submitted and will help us improve.</p>
        <button id="closeSuccessBtn" class="action-btn">Close</button>
    </div>
</div>

<!-- Backdrop for modals -->
<div id="feedbackBackdrop" class="feedback-backdrop"></div>
<!-- No Match Alert -->
<!-- Enhanced No Match Alert -->
<div id="noMatchBackdrop" class="no-match-backdrop"></div>
<div id="noMatchAlert" class="no-match-alert">
    <div class="alert-icon">ü§î</div>
    <div class="alert-title">No Match Found</div>
    <div class="alert-message">
        We couldn't find a matching question in our database. Would you like to try asking again, 
        or get help from our AI assistant?
    </div>
    
    <!-- Enhanced Countdown Timer -->
    <div class="countdown-container">
        <div class="countdown-text">Auto-submitting to Gemini AI in:</div>
        <div class="countdown-timer" id="countdownTimer">10</div>
        <div class="countdown-progress">
            <div class="countdown-progress-bar" id="countdownProgress"></div>
        </div>
    </div>
    
    <div class="alert-buttons">
        <button class="alert-btn alert-btn-primary" id="tryAgainBtn">
            <i class="fas fa-redo"></i> Try Again
        </button>
        <button class="alert-btn alert-btn-secondary" id="askGeminiBtn">
            <i class="fas fa-robot"></i> Ask Gemini AI
        </button>
        <button class="alert-btn alert-btn-tertiary" id="uploadFileBtn">
            <i class="fas fa-upload"></i> Upload File & Ask
        </button>
    </div>
</div>

<!-- Gemini Chatbot -->
<div class="gemini-chatbot">
    <button class="chatbot-trigger" id="chatbotTrigger">
        <i class="fas fa-robot"></i>
    </button>
    
    <div class="chatbot-window" id="chatbotWindow">
        <div class="chatbot-header">
            <span>ü§ñ Gemini AI Assistant</span>
            <button class="chatbot-close" id="chatbotClose">&times;</button>
        </div>
        
        <div class="gemini-chat-area" id="geminiChatArea">
            <div class="gemini-message gemini-ai-message">
                Hi! I'm your AI assistant powered by Gemini 2.0 Flash. How can I help you today?
            </div>
        </div>
        
        <div class="gemini-input-area">
            <form class="gemini-input-form" id="geminiForm">
                <input type="text" class="gemini-input" id="geminiInput" placeholder="Ask me anything...">
                <button type="submit" class="gemini-send-btn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </form>
        </div>
    </div>
<script>

    // Video Transcription Logic
document.addEventListener('DOMContentLoaded', function() {
    const videoUrlInput = document.getElementById('videoUrl');
    const videoFileInput = document.getElementById('videoFile');
    const startTimeInput = document.getElementById('startTime');
    const endTimeInput = document.getElementById('endTime');
    const correctTextCheckbox = document.getElementById('correctText');
    const translateToHindiCheckbox = document.getElementById('translateToHindi');
    const transcribeBtn = document.getElementById('transcribeBtn');
    
    const transcriptionResults = document.querySelector('.transcription-results');
    const englishTranscript = document.getElementById('englishTranscript');
    const hindiTranscript = document.getElementById('hindiTranscript');
    const englishAudio = document.getElementById('englishAudio');
    const hindiAudio = document.getElementById('hindiAudio');
    
    const copyTranscriptBtn = document.getElementById('copyTranscriptBtn');
    const downloadTranscriptBtn = document.getElementById('downloadTranscriptBtn');
    const clearTranscriptionBtn = document.getElementById('clearTranscriptionBtn');
    
    const hindiResultTab = document.querySelector('.result-tab[data-result="hindi"]');
    const transcriptionUsageCount = document.getElementById('transcriptionUsageCount');
    
    // Initialize usage counter from localStorage
    let usageCount = parseInt(localStorage.getItem('transcriptionUsageCount') || '0');
    updateUsageCount(usageCount);
    
    // Function to update and display usage count
    function updateUsageCount(count) {
        usageCount = count;
        localStorage.setItem('transcriptionUsageCount', count.toString());
        transcriptionUsageCount.textContent = `Used: ${count} times`;
    }
    
    // Tab switching for URL/Upload
    document.querySelectorAll('.transcription-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            // Update active tab
            document.querySelectorAll('.transcription-tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            
            // Show corresponding tab content
            const tabId = this.getAttribute('data-tab') + 'Tab';
            document.querySelectorAll('.transcription-tab-content').forEach(content => {
                content.classList.remove('active');
            <!-- Removed unmatched closing brace and parenthesis -->
            document.getElementById(tabId).classList.add('active');
        });
    });
    
    // Tab switching for results (English/Hindi)
    document.querySelectorAll('.result-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            // Update active tab
            document.querySelectorAll('.result-tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            
            // Show corresponding result
            const resultId = this.getAttribute('data-result') + 'Result';
            document.querySelectorAll('.result-container').forEach(container => {
                container.classList.remove('active');
            });
            document.getElementById(resultId).classList.add('active');
        });
    });
    
    // Transcribe button click
    transcribeBtn.addEventListener('click', function() {
        // Get input values
        const videoUrl = videoUrlInput.value.trim();
        const videoFile = videoFileInput.files[0];
        const startTime = startTimeInput.value ? parseInt(startTimeInput.value) : 0;
        const endTime = endTimeInput.value ? parseInt(endTimeInput.value) : null;
        const correctText = correctTextCheckbox.checked;
        const translateToHindi = translateToHindiCheckbox.checked;
        
        // Validate input
        if (!videoUrl && !videoFile) {
            alert('Please enter a video URL or upload a video file');
            return;
        }
        
        // Create form data
        const formData = new FormData();
        
        if (videoUrl) {
            formData.append('video_url', videoUrl);
        }
        
        if (videoFile) {
            formData.append('file', videoFile);
        }
        
        formData.append('start_time', startTime);
        if (endTime) formData.append('end_time', endTime);
        formData.append('correct_text', correctText);
        formData.append('translate_to_hindi', translateToHindi);
        
        // Show loading indicator
        transcribeBtn.disabled = true;
        transcribeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Transcribing...';
        
        // Hide results while processing
        transcriptionResults.style.display = 'none';
        
        // Send request to server
        fetch('/transcribe-video', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            // Reset button
            transcribeBtn.disabled = false;
            transcribeBtn.innerHTML = 'Transcribe Video';
            
            if (data.success) {
                // Update usage count
                updateUsageCount(usageCount + 1);
                
                // Display English transcript
                englishTranscript.textContent = data.corrected_transcript || data.transcript;
                
                // Set English audio if available
                if (data.audio_english_id) {
                    englishAudio.src = `/audio/${data.audio_english_id}`;
                    englishAudio.parentElement.style.display = 'block';
                } else {
                    englishAudio.parentElement.style.display = 'none';
                }
                
                // Display Hindi transcript and tab if available
                if (data.hindi_transcript) {
                    hindiTranscript.textContent = data.hindi_transcript;
                    hindiResultTab.style.display = 'block';
                    
                    // Set Hindi audio if available
                    if (data.audio_hindi_id) {
                        hindiAudio.src = `/audio/${data.audio_hindi_id}`;
                        hindiAudio.parentElement.style.display = 'block';
                    } else {
                        hindiAudio.parentElement.style.display = 'none';
                    }
                } else {
                    hindiResultTab.style.display = 'none';
                }
                
                // Show results
                transcriptionResults.style.display = 'block';
                
                // Reset result tabs to English
                document.querySelector('.result-tab[data-result="english"]').click();
            } else {
                alert('Error: ' + (data.error || 'Failed to transcribe video'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            transcribeBtn.disabled = false;
            transcribeBtn.innerHTML = 'Transcribe Video';
            alert('Error transcribing video. Please try again.');
    });
    
    // Copy transcript button
    copyTranscriptBtn.addEventListener('click', function() {
        // Get active result container
        const activeContainer = document.querySelector('.result-container.active');
        const textElement = activeContainer.querySelector('.transcript-text');
        
        // Copy text to clipboard
        navigator.clipboard.writeText(textElement.textContent).then(() => {
            this.textContent = 'Copied!';
            setTimeout(() => { this.textContent = 'Copy Text'; }, 2000);
        });
    });
    
    // Download transcript button
    downloadTranscriptBtn.addEventListener('click', function() {
        // Get active result container
        const activeContainer = document.querySelector('.result-container.active');
        const textElement = activeContainer.querySelector('.transcript-text');
        const isHindi = activeContainer.id === 'hindiResult';
        
        // Create file
        const filename = `transcript_${isHindi ? 'hindi' : 'english'}_${new Date().toISOString().slice(0,10)}.txt`;
        const blob = new Blob([textElement.textContent], {type: 'text/plain'});
        
        // Create download link and click it
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = filename;
        link.click();
    });
    
    // Clear button
    clearTranscriptionBtn.addEventListener('click', function() {
        // Clear inputs
        videoUrlInput.value = '';
        videoFileInput.value = '';
        startTimeInput.value = '';
        endTimeInput.value = '';
        correctTextCheckbox.checked = false;
        translateToHindiCheckbox.checked = false;
        
        // Clear results
        englishTranscript.textContent = '';
        hindiTranscript.textContent = '';
        englishAudio.src = '';
        hindiAudio.src = '';
        
        // Hide results section
        transcriptionResults.style.display = 'none';
    });
});

// Graded Assignment Questions - loaded dynamically from vickys.json
let gradedAssignmentQuestions = [];

document.addEventListener('DOMContentLoaded', function() {
    // Get all necessary elements with null checks
    const chatBox = document.getElementById('chatBox');
    const questionForm = document.getElementById('questionForm');
    const questionInput = document.getElementById('questionInput');
    const preloadedQuestionsContainer = document.getElementById('preloadedQuestions');
    const categoryTabs = document.querySelectorAll('.category-tab');
    
    // Load graded assignment questions from vickys.json
    async function loadGradedAssignmentQuestions() {
        try {
            const response = await fetch('/static/vickys.json');
            const questionsData = await response.json();
            
            // Transform vickys.json data to our format and categorize automatically
            gradedAssignmentQuestions = questionsData.map(item => {
                // Extract GA category from file path
                const gaMatch = item.file.match(/GA(\\d+)/i);
                const category = gaMatch ? `GA${gaMatch[1]}` : 'GA1';
                
                return {
                    id: `ga${category.toLowerCase()}-${Date.now()}-${Math.random()}`,
                    text: item.question,
                    category: category,
                    filePath: item.file
                };
            });
            
            // Initialize with GA1 questions after loading
            if (preloadedQuestionsContainer) {
                displayPreloadedQuestions('GA1');
            }
            
        } catch (error) {
            console.error('Error loading graded assignment questions:', error);
            if (preloadedQuestionsContainer) {
                preloadedQuestionsContainer.innerHTML = '<div class="error">Failed to load questions</div>';
            }
        }
    }
    
    // Question type selector
    const fileBasedQuestions = {{ file_based_questions|tojson }};
    const questionTypeBtns = document.querySelectorAll('.question-type-btn');
    const gaSidebar = document.getElementById('gaSidebar');
    const fileSidebar = document.getElementById('fileSidebar');
    const fileCategories = document.getElementById('fileCategories');
    const fileQuestionsContainer = document.getElementById('fileQuestions');

    // Function to add a message to the chat
    function addMessage(text, type, id = null) {
        const messageElement = document.createElement('div');
        messageElement.className = `message ${type}-message`;
        if (id) messageElement.id = id;
        
        // Process code blocks if it's a bot message
        if (type === 'bot' || type === 'bot loading') {
            // Simple code block detection for ```code``` blocks
            text = text.replace(/```([^`]+)```/g, function(match, codeContent) {
                return `<div class="code-block">${codeContent}<button class="copy-button">Copy</button></div>`;
            });
            
            // Inline code detection for `code`
            text = text.replace(/`([^`]+)`/g, '<code>$1</code>');
        }
        
        messageElement.innerHTML = text;
        
        // Add copy functionality to code blocks
        if (type === 'bot') {
            setTimeout(() => {
                messageElement.querySelectorAll('.copy-button').forEach(button => {
                    button.addEventListener('click', function() {
                        const codeBlock = this.parentNode;
                        const code = codeBlock.textContent.replace('Copy', '').trim();
                        
                        navigator.clipboard.writeText(code).then(() => {
                            this.textContent = 'Copied!';
                            setTimeout(() => { this.textContent = 'Copy'; }, 2000);
                        });
                    });
                });
            }, 0);
        }
        
        chatBox.appendChild(messageElement);
        chatBox.scrollTop = chatBox.scrollHeight;
        return messageElement;
    }

    // Initialize file sidebar
    if (fileBasedQuestions && fileBasedQuestions.length > 0) {
        initializeFileSidebar();
    }

    // Handle question type switching
    questionTypeBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            // Update active state
            questionTypeBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            // Show/hide appropriate sidebar
            const type = this.dataset.type;
            if (type === 'ga') {
                if (gaSidebar) gaSidebar.style.display = 'flex';
                if (fileSidebar) fileSidebar.style.display = 'none';
            } else {
                if (gaSidebar) gaSidebar.style.display = 'none';
                if (fileSidebar) fileSidebar.style.display = 'flex';
            }
        });
    });

    // Initialize file sidebar content
    function initializeFileSidebar() {
        // Check if required elements exist
        if (!fileCategories || !fileQuestionsContainer) {
            console.warn('File sidebar elements not found');
            return;
        }
        
        // Create file category buttons
        fileCategories.innerHTML = '';
        let firstFile = null;
        
        fileBasedQuestions.forEach(fileGroup => {
            if (!firstFile) firstFile = fileGroup.file;
            
            const fileBtn = document.createElement('div');
            fileBtn.className = 'file-category';
            if (fileGroup.file === firstFile) {
                fileBtn.classList.add('active');
            }
            fileBtn.textContent = fileGroup.file;
            fileBtn.dataset.file = fileGroup.file;
            
            fileBtn.addEventListener('click', function() {
                // Update active state
                document.querySelectorAll('.file-category').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                // Display questions for the selected file
                displayFileQuestions(this.dataset.file);
            });
            
            fileCategories.appendChild(fileBtn);
        });
        
        // Display questions for the first file
        if (firstFile) {
            displayFileQuestions(firstFile);
        }
    }

    // Display questions for a specific file
    function displayFileQuestions(fileName) {
        fileQuestionsContainer.innerHTML = '';
        
        // Find questions for this file
        const fileGroup = fileBasedQuestions.find(group => group.file === fileName);
        if (!fileGroup || !fileGroup.questions) {
            fileQuestionsContainer.innerHTML = `<div class="notice">No questions found for ${fileName}</div>`;
            return;
        }
        
        // Display each question
        fileGroup.questions.forEach(item => {
            const questionItem = document.createElement('div');
            questionItem.className = 'file-question-item';
            
            const questionText = document.createElement('div');
            questionText.className = 'question-text';
            questionText.textContent = item.question;
            
            const filePath = document.createElement('div');
            filePath.className = 'question-file-path';
            filePath.textContent = item.file || 'No file path';
            
            const askButton = document.createElement('button');
            askButton.className = 'ask-button';
            askButton.textContent = 'Ask';
            
            questionItem.appendChild(questionText);
            questionItem.appendChild(filePath);
            questionItem.appendChild(askButton);
            
            // Full item click handler
            questionItem.addEventListener('click', (e) => {
                // Don't trigger if clicking the button
                if (e.target !== askButton) {
                    questionInput.value = item.question;
                }
            });
            
            // Specific button click handler
            askButton.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent the item click event
                questionInput.value = item.question;
                // Auto-submit the question on button click
                questionForm.dispatchEvent(new Event('submit'));
            });
            
            fileQuestionsContainer.appendChild(questionItem);
        });
    }
    
    // Initialize by loading graded assignment questions
    loadGradedAssignmentQuestions();
    
    // Handle category switching - moved to after loading questions
    if (categoryTabs && categoryTabs.length > 0) {
        categoryTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                // Update active tab
                categoryTabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                // Display questions for the selected category
                displayPreloadedQuestions(this.dataset.category);
            });
        });
    }
    
    // Display graded assignment questions for a specific category
    function displayPreloadedQuestions(category) {
        if (!preloadedQuestionsContainer) {
            console.warn('preloadedQuestionsContainer not found');
            return;
        }
        
        preloadedQuestionsContainer.innerHTML = '';
        
        if (!gradedAssignmentQuestions || gradedAssignmentQuestions.length === 0) {
            preloadedQuestionsContainer.innerHTML = '<div class="loading">Loading questions...</div>';
            return;
        }
        
        const filteredQuestions = gradedAssignmentQuestions.filter(q => q.category === category);
        
        if (filteredQuestions.length === 0) {
            preloadedQuestionsContainer.innerHTML = `<div class="notice">No questions found for ${category}</div>`;
            return;
        }
        
        filteredQuestions.forEach(question => {
            const questionItem = document.createElement('div');
            questionItem.className = 'question-item';
            
            // Create question content with file path
            const questionContent = document.createElement('div');
            questionContent.className = 'question-content';
            
            if (question.filePath) {
                const filePath = document.createElement('div');
                filePath.className = 'question-file-path';
                filePath.textContent = question.filePath;
                questionContent.appendChild(filePath);
            }
            
            const questionText = document.createElement('div');
            questionText.className = 'question-text';
            questionText.textContent = question.text.length > 150 ? 
                question.text.substring(0, 150) + '...' : question.text;
            questionContent.appendChild(questionText);
            
            questionItem.appendChild(questionContent);
            
            questionItem.addEventListener('click', () => {
                if (questionInput) {
                    questionInput.value = question.text;
                    // Auto-submit the question on click
                    if (questionForm) {
                        questionForm.dispatchEvent(new Event('submit'));
                    }
                }
            });
            
            preloadedQuestionsContainer.appendChild(questionItem);
        });
    }
    
    // Handle file upload links
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('delete-link')) {
            if (!confirm('Are you sure you want to delete this file?')) {
                e.preventDefault();
            }
        }
    });
    
    // Function to send questions with file
    window.sendQuestionWithFile = function(event) {
        event.preventDefault();
        const question = document.getElementById('questionInput').value.trim();
        if (!question) return;
        
        // Display user question
        addMessage(question, 'user');
        
        // Clear input
        document.getElementById('questionInput').value = '';
        
        // Display loading indicator
        const loadingId = 'loading-' + Date.now();
        addMessage('Thinking...', 'bot loading', loadingId);
        
        // Create form data
        const formData = new FormData();
        formData.append('question', question);
        
        // Add file if present
        const fileInput = document.getElementById('fileAttachment');
        if (fileInput.files.length > 0) {
            formData.append('file', fileInput.files[0]);
        }
        
        fetch('/ask_with_file', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            // Remove loading message
            const loadingMsg = document.getElementById(loadingId);
            if (loadingMsg) loadingMsg.remove();
            
            if (data.success) {
                addMessage(data.answer || "No response received", 'bot');
            } else if (data.no_match) {
                // Show no match alert instead of error message
                showNoMatchAlert(data.question, data.has_file);
            } else {
                addMessage("Error: " + (data.error || "Unknown error occurred"), 'bot');
            }
        })
        .catch(error => {
            // Remove loading message
            const loadingMsg = document.getElementById(loadingId);
            if (loadingMsg) loadingMsg.remove();
            
            console.error('Error:', error);
            addMessage("Sorry, there was an error processing your question.", 'bot');
        });
    };
    
    // Check server status and update the status indicator
    fetch('/health')
        .then(response => {
            if (response.ok) {
                document.querySelector('.status-dot').style.backgroundColor = '#4CAF50'; // Green
            } else {
                document.querySelector('.status-dot').style.backgroundColor = '#f44336'; // Red
            }
        })
        .catch(() => {
            document.querySelector('.status-dot').style.backgroundColor = '#f44336'; // Red
        });
        
    // Load uploaded files list
    function loadUploadedFiles() {
        fetch('/files')
            .then(response => response.text())
            .then(html => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const filesList = doc.querySelector('.files-table tbody');
                if (filesList) {
                    const uploadedFilesList = document.getElementById('uploadedFilesList');
                    uploadedFilesList.innerHTML = '';
                    
                    Array.from(filesList.querySelectorAll('tr')).forEach(row => {
                        const fileId = row.cells[0].textContent;
                        const fileName = row.cells[1].textContent;
                        
                        const li = document.createElement('li');
                        li.innerHTML = `
                            <span>${fileName} (ID: ${fileId})</span>
                            <div>
                                <a href="#" class="use-file" data-id="${fileId}">Use</a>
                                <a href="#" class="delete-file" data-id="${fileId}">Delete</a>
                            </div>
                        `;
                        uploadedFilesList.appendChild(li);
                    });
                    
                    // Add event listeners to use/delete links
                    document.querySelectorAll('.use-file').forEach(link => {
                        link.addEventListener('click', function(e) {
                            e.preventDefault();
                            const fileId = this.dataset.id;
                            questionInput.value += ` with ID ${fileId}`;
                            questionInput.focus();
                        });
                    });
                    
                    document.querySelectorAll('.delete-file').forEach(link => {
                        link.addEventListener('click', function(e) {
                            e.preventDefault();
                            if (confirm('Are you sure you want to delete this file?')) {
                                const fileId = this.dataset.id;
                                fetch(`/delete-file/${fileId}`, { method: 'DELETE' })
                                    .then(response => response.json())
                                    .then(data => {
                                        if (data.success) {
                                            loadUploadedFiles();
                                        }
                                    });
                            }
                        });
                    });
                }
            });
    }
    
    // Load uploaded files on page load
    loadUploadedFiles();
});

function debugForm() {
    const formData = new FormData();
    formData.append('question', 'Test question');
    
    fetch('/debug-form', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        console.log('Debug data:', data);
        alert('Check console for debug info');
    });
}

// Base64 Image Decoder Logic
document.addEventListener('DOMContentLoaded', function() {
    // Elements
    const base64Input = document.getElementById('base64Input');
    const previewImage = document.getElementById('previewImage');
    const imagePreview = document.getElementById('imagePreview');
    const copyImageBtn = document.getElementById('copyImageBtn');
    const downloadImageBtn = document.getElementById('downloadImageBtn');
    const clearImageBtn = document.getElementById('clearImageBtn');
    const imageFileInput = document.getElementById('imageFileInput');
    const usageCounter = document.getElementById('decoderUsageCount');
    
    // Initialize usage counter from localStorage
    let usageCount = parseInt(localStorage.getItem('base64DecoderUsageCount') || '0');
    updateUsageCount(usageCount);
    
    // Function to update and display usage count
    function updateUsageCount(count) {
        usageCount = count;
        localStorage.setItem('base64DecoderUsageCount', count.toString());
        usageCounter.textContent = `Used: ${count} times`;
        
        // Log usage for analytics 
        if (count % 10 === 0 && count > 0) {
            // Log every 10th use for analytics
            fetch('/log-base64-usage', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ count: count })
            }).catch(err => console.log('Usage tracking error:', err));
        }
    }
    
    // Process base64 input (decoding)
    base64Input.addEventListener('input', function() {
        const base64String = this.value.trim();
        
        if (!base64String) {
            imagePreview.style.display = 'none';
            return;
        }
        
        // Process the input
        let imageData = base64String;
        
        // Try to add data:image prefix if missing
        if (!base64String.startsWith('data:image')) {
            // Detect if we need to add the full prefix or just part of it
            if (base64String.includes('base64,')) {
                imageData = 'data:image/png;' + base64String.substring(base64String.indexOf('base64,'));
            } else {
                imageData = 'data:image/png;base64,' + base64String;
            }
        }
        
        // Update the image source
        try {
            previewImage.src = imageData;
            previewImage.onload = function() {
                // Successfully loaded, show the preview
                imagePreview.style.display = 'block';
                // Increment the usage count
                updateUsageCount(usageCount + 1);
            };
            
            previewImage.onerror = function() {
                // Hide preview if invalid
                imagePreview.style.display = 'none';
            };
        } catch (e) {
            console.error('Error displaying image:', e);
            imagePreview.style.display = 'none';
        }
    });
    
    // Copy image data to clipboard
    copyImageBtn.addEventListener('click', function() {
        navigator.clipboard.writeText(previewImage.src).then(() => {
            this.textContent = 'Copied!';
            setTimeout(() => { this.textContent = 'Copy Data'; }, 2000);
        });
    });
    
    // Download the image
    downloadImageBtn.addEventListener('click', function() {
        const imageData = previewImage.src;
        const extension = imageData.includes('image/jpeg') ? 'jpg' : 
                        imageData.includes('image/png') ? 'png' :
                        imageData.includes('image/gif') ? 'gif' : 'png';
        
        const link = document.createElement('a');
        link.href = imageData;
        link.download = `decoded_image.${extension}`;
        link.click();
    });
    
    // Clear input and preview
    clearImageBtn.addEventListener('click', function() {
        base64Input.value = '';
        imagePreview.style.display = 'none';
        previewImage.src = '';
    });
    
    // Handle image file selection for encoding
    imageFileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
            // Get base64 data
            const base64 = e.target.result;
            
            // Update textarea with base64 data
            base64Input.value = base64;
            
            // Update image preview
            previewImage.src = base64;
            imagePreview.style.display = 'block';
            
            // Increment the usage count
            updateUsageCount(usageCount + 1);
        };
        
        reader.readAsDataURL(file);
    });
    
    // Handle direct paste from clipboard (for images)
    base64Input.addEventListener('paste', function(e) {
        // Check if paste has image data
        const items = (e.clipboardData || e.originalEvent.clipboardData).items;
        
        for (const item of items) {
            if (item.type.indexOf('image') === 0) {
                // Prevent default to stop text pasting
                e.preventDefault();
                
                // Get the image as a blob
                const blob = item.getAsFile();
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    // Get base64 data
                    const base64 = event.target.result;
                    
                    // Update textarea with base64 data
                    base64Input.value = base64;
                    
                    // Update image preview
                    previewImage.src = base64;
                    imagePreview.style.display = 'block';
                    
                    // Increment the usage count
                    updateUsageCount(usageCount + 1);
                });
            }
        }
    });
});

// API Status Monitoring
document.addEventListener('DOMContentLoaded', function() {
    // Initialize API status elements
    const apiStatusIndicator = document.getElementById('apiStatus');
    const lastCheckedElement = document.getElementById('lastChecked');
    
    // Function to update API status in UI
    function updateApiStatusUI(status, lastChecked) {
        // Check if elements exist before trying to use them
        if (!apiStatusIndicator) {
            console.log('API status indicator not found');
            return;
        }
        
        // Remove all status classes
        apiStatusIndicator.classList.remove('status-up', 'status-down', 'status-unknown');
        
        // Add appropriate class and text
        if (status === 'up') {
            apiStatusIndicator.classList.add('status-up');
            const statusDot = apiStatusIndicator.querySelector('.status-dot');
            const statusText = apiStatusIndicator.querySelector('.status-text');
            if (statusDot) statusDot.style.backgroundColor = '#4CAF50';
            if (statusText) statusText.textContent = 'API: ONLINE';
        } else if (status === 'down') {
            apiStatusIndicator.classList.add('status-down');
            const statusDot = apiStatusIndicator.querySelector('.status-dot');
            const statusText = apiStatusIndicator.querySelector('.status-text');
            if (statusDot) statusDot.style.backgroundColor = '#f44336';
            if (statusText) statusText.textContent = 'API: OFFLINE';
        } else {
            apiStatusIndicator.classList.add('status-unknown');
            const statusDot = apiStatusIndicator.querySelector('.status-dot');
            const statusText = apiStatusIndicator.querySelector('.status-text');
            if (statusDot) statusDot.style.backgroundColor = '#ff9800';
            if (statusText) statusText.textContent = 'API: CHECKING';
        }
        
        // Update last checked time if available
        if (lastChecked && lastCheckedElement) {
            const date = new Date(lastChecked);
            lastCheckedElement.textContent = `Last checked: ${date.toLocaleTimeString()}`;
        }
    }
    
    // Function to check API status
    async function checkApiStatus() {
        try {
            const response = await fetch('/api-status');
            if (response.ok) {
                const data = await response.json();
                updateApiStatusUI(data.status, data.last_checked);
            } else {
                updateApiStatusUI('down');
            }
        } catch (error) {
            console.error('Error checking API status:', error);
            updateApiStatusUI('down');
        }
    }
    
    // Check status immediately and then every 60 seconds
    checkApiStatus();
    setInterval(checkApiStatus, 60000);
});

// HTML Viewer Logic
document.addEventListener('DOMContentLoaded', function() {
    const urlInput = document.getElementById('urlInput');
    const fetchUrlBtn = document.getElementById('fetchUrlBtn');
    const htmlPreview = document.getElementById('htmlPreview');
    const previewFrame = document.getElementById('previewFrame');
    const copyHtmlBtn = document.getElementById('copyHtmlBtn');
    const viewSourceBtn = document.getElementById('viewSourceBtn');
    const clearViewerBtn = document.getElementById('clearViewerBtn');
    const viewerUsageCount = document.getElementById('viewerUsageCount');
    
    // Initialize usage counter from localStorage
    let usageCount = parseInt(localStorage.getItem('htmlViewerUsageCount') || '0');
    updateUsageCount(usageCount);
    
    // Function to update and display usage count
    function updateUsageCount(count) {
        usageCount = count;
        localStorage.setItem('htmlViewerUsageCount', count.toString());
        viewerUsageCount.textContent = `Used: ${count} times`;
        
        // Log usage for analytics 
        if (count % 10 === 0 && count > 0) {
            fetch('/log-html-viewer-usage', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ count: count })
            }).catch(err => console.log('Usage tracking error:', err));
        }
    }
    
    // Create source view element if needed
    function getSourceView() {
        let sourceView = document.getElementById('sourceView');
        if (!sourceView) {
            sourceView = document.createElement('pre');
            sourceView.id = 'sourceView';
            sourceView.className = 'source-view';
            htmlPreview.appendChild(sourceView);
        }
        return sourceView;
    }
    
    // Fetch website content
    fetchUrlBtn.addEventListener('click', function() {
        let url = urlInput.value.trim();
        if (!url) return;
        
        // Add https:// if not present
        if (!/^https?:\\/\\//i.test(url)) {
            url = 'https://' + url;
            urlInput.value = url;
        }
        
        // Show loading state
        previewFrame.srcdoc = '<div style="padding:20px; text-align:center;"><p>Loading...</p></div>';
        htmlPreview.style.display = 'block';
        
        // Hide source view if visible
        const sourceView = getSourceView();
        sourceView.style.display = 'none';
        
        // Using a CORS proxy to fetch the content
        fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`)
            .then(response => response.json())
            .then(data => {
                if (data && data.contents) {
                    // Display the HTML in the iframe
                    previewFrame.srcdoc = data.contents;
                    
                    // Store the source for later viewing
                    sourceView.textContent = data.contents;
                    
                    // Increment the usage count
                    updateUsageCount(usageCount + 1);
                } else {
                    previewFrame.srcdoc = '<div style="padding:20px; color:red;">Error: Could not fetch content.</div>';
                }
            })
            .catch(error => {
                previewFrame.srcdoc = `<div style="padding:20px; color:red;">Error: ${error.message}</div>`;
            });
    });
    
    // Copy HTML content
    copyHtmlBtn.addEventListener('click', function() {
        const sourceView = getSourceView();
        const html = sourceView.textContent;
        
        navigator.clipboard.writeText(html).then(() => {
            this.textContent = 'Copied!';
            setTimeout(() => { this.textContent = 'Copy HTML'; }, 2000);
        });
    });
    
    // View source HTML
    viewSourceBtn.addEventListener('click', function() {
        const sourceView = getSourceView();
        if (sourceView.style.display === 'block') {
            sourceView.style.display = 'none';
            this.textContent = 'View Source';
        } else {
            sourceView.style.display = 'block';
            this.textContent = 'Hide Source';
        }
    });
    
    // Clear the viewer
    clearViewerBtn.addEventListener('click', function() {
        urlInput.value = '';
        htmlPreview.style.display = 'none';
        previewFrame.srcdoc = '';
        
        const sourceView = getSourceView();
        sourceView.style.display = 'none';
        sourceView.textContent = '';
        viewSourceBtn.textContent = 'View Source';
    });
    
    // Handle Enter key in URL input
    urlInput.addEventListener('keyup', function(event) {
        if (event.key === 'Enter') {
            fetchUrlBtn.click();
        }
    });
});

// Feedback System
document.addEventListener('DOMContentLoaded', function() {
    // Elements
    const feedbackBtn = document.getElementById('feedbackBtn');
    const feedbackDialog = document.getElementById('feedbackDialog');
    const feedbackYesBtn = document.getElementById('feedbackYesBtn');
    const feedbackNoBtn = document.getElementById('feedbackNoBtn');
    const feedbackForm = document.getElementById('feedbackForm');
    const closeFormBtn = document.getElementById('closeFormBtn');
    const submitFeedbackBtn = document.getElementById('submitFeedbackBtn');
    const feedbackSuccess = document.getElementById('feedbackSuccess');
    const closeSuccessBtn = document.getElementById('closeSuccessBtn');
    const feedbackBackdrop = document.getElementById('feedbackBackdrop');
    
    // Feedback button click - show initial dialog
    feedbackBtn.addEventListener('click', function() {
        feedbackBackdrop.style.display = 'block';
        feedbackDialog.style.display = 'block';
    });
    
    // "Yes" button - open feedback form
    feedbackYesBtn.addEventListener('click', function() {
        feedbackDialog.style.display = 'none';
        feedbackForm.style.display = 'block';
    });
    
    // "No" button - close dialog
    feedbackNoBtn.addEventListener('click', function() {
        feedbackBackdrop.style.display = 'none';
        feedbackDialog.style.display = 'none';
    });
    
    // Close form button
    closeFormBtn.addEventListener('click', function() {
        feedbackBackdrop.style.display = 'none';
        feedbackForm.style.display = 'none';
        resetForm();
    });
    
    // Close success message
    closeSuccessBtn.addEventListener('click', function() {
        feedbackBackdrop.style.display = 'none';
        feedbackSuccess.style.display = 'none';
    });
    
    // Click on backdrop
    feedbackBackdrop.addEventListener('click', function() {
        feedbackBackdrop.style.display = 'none';
        feedbackDialog.style.display = 'none';
        feedbackForm.style.display = 'none';
        feedbackSuccess.style.display = 'none';
        resetForm();
    });
    
    // Submit feedback
    submitFeedbackBtn.addEventListener('click', function() {
        const name = document.getElementById('feedbackName').value;
        const email = document.getElementById('feedbackEmail').value;
        const type = document.getElementById('feedbackType').value;
        const text = document.getElementById('feedbackText').value;
        
        // Validate
        if (!text.trim()) {
            alert('Please enter your feedback');
            return;
        }
        
        // Disable button and show loading state
        submitFeedbackBtn.disabled = true;
        submitFeedbackBtn.textContent = 'Submitting...';
        
        // Submit via fetch API
        fetch('/submit-feedback', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                name: name,
                email: email,
                type: type,
                feedback: text
            })
        })
        .then(response => response.json())
        .then(data => {
            // Show success message
            feedbackForm.style.display = 'none';
            feedbackSuccess.style.display = 'block';
            resetForm();
        })
        .catch(error => {
            alert('Error submitting feedback. Please try again.');
            console.error('Error:', error);
        })
        .finally(() => {
            // Reset button state
            submitFeedbackBtn.disabled = false;
            submitFeedbackBtn.textContent = 'Submit Feedback';
        });
    });
    
    // Reset form function
    function resetForm() {
        document.getElementById('feedbackName').value = '';
        document.getElementById('feedbackEmail').value = '';
        document.getElementById('feedbackType').selectedIndex = 0;
        document.getElementById('feedbackText').value = '';
    }
});


// Replace the problematic JavaScript section with this corrected version:

// No Match Alert and Enhanced Gemini Chatbot Logic
document.addEventListener('DOMContentLoaded', function() {
    const noMatchAlert = document.getElementById('noMatchAlert');
    const noMatchBackdrop = document.getElementById('noMatchBackdrop');
    const tryAgainBtn = document.getElementById('tryAgainBtn');
    const askGeminiBtn = document.getElementById('askGeminiBtn');
    const uploadFileBtn = document.getElementById('uploadFileBtn');
    const countdownTimer = document.getElementById('countdownTimer');
    const countdownProgress = document.getElementById('countdownProgress');
    const chatbotTrigger = document.getElementById('chatbotTrigger');
    const chatbotWindow = document.getElementById('chatbotWindow');
    const chatbotClose = document.getElementById('chatbotClose');
    const geminiForm = document.getElementById('geminiForm');
    const geminiInput = document.getElementById('geminiInput');
    const geminiChatArea = document.getElementById('geminiChatArea');
    
    let currentFailedQuestion = '';
    let currentHasFile = false;
    let countdownInterval = null;
    let autoSubmitTimeout = null;
    
    // Show no match alert with auto-submit option
    function showNoMatchAlert(question, hasFile) {
        currentFailedQuestion = question;
        currentHasFile = hasFile;
        noMatchBackdrop.style.display = 'block';
        noMatchAlert.style.display = 'block';
        startCountdown();

        
    }
    function startCountdown() {
        let timeLeft = 10; // 10 seconds countdown
        countdownTimer.textContent = timeLeft;
        countdownProgress.style.width = '100%';
        
        // Clear any existing intervals
        if (countdownInterval) clearInterval(countdownInterval);
        if (autoSubmitTimeout) clearTimeout(autoSubmitTimeout);
        
        countdownInterval = setInterval(() => {
            timeLeft--;
            countdownTimer.textContent = timeLeft;
            
            // Update progress bar
            const progressPercentage = (timeLeft / 10) * 100;
            countdownProgress.style.width = progressPercentage + '%';
            
            // Add warning animation when time is running out
            if (timeLeft <= 3) {
                countdownTimer.style.color = '#ff6b6b';
                countdownTimer.style.animation = 'pulse 0.5s ease-in-out infinite alternate';
            }
            
            if (timeLeft <= 0) {
                clearInterval(countdownInterval);
                // Auto-submit to Gemini
                autoSubmitToGemini();
            }
        }, 1000);
        
        // Set timeout as backup
        autoSubmitTimeout = setTimeout(() => {
            if (noMatchAlert.style.display === 'block') {
                autoSubmitToGemini();
            }
        }, 10000); // 10 seconds
    }
    
    function autoSubmitToGemini() {
        // Clear intervals
        if (countdownInterval) clearInterval(countdownInterval);
        if (autoSubmitTimeout) clearTimeout(autoSubmitTimeout);
        
        // Hide alert and show chatbot
        hideNoMatchAlert();
        showChatbot();
        
        if (currentFailedQuestion) {
            geminiInput.value = currentFailedQuestion;
            // Auto-submit the form with a slight delay for better UX
            setTimeout(() => {
                geminiForm.dispatchEvent(new Event('submit'));
            }, 500);
        }
    }
    
    function stopCountdown() {
        if (countdownInterval) clearInterval(countdownInterval);
        if (autoSubmitTimeout) clearTimeout(autoSubmitTimeout);
    }
    
    
    // Make showNoMatchAlert available globally
    window.showNoMatchAlert = showNoMatchAlert;
    
    // Hide no match alert
    function hideNoMatchAlert() {
        noMatchBackdrop.style.display = 'none';
        noMatchAlert.style.display = 'none';
        // Reset countdown display
        countdownTimer.textContent = '10';
        countdownTimer.style.color = 'white';
        countdownTimer.style.animation = 'pulse 1s ease-in-out infinite alternate';
        countdownProgress.style.width = '100%';
    }
    
    // Try again button
    tryAgainBtn.addEventListener('click', function() {
        hideNoMatchAlert();
        document.getElementById('questionInput').focus();
    });
    
    // Ask Gemini button - immediate submit
    askGeminiBtn.addEventListener('click', function() {
        autoSubmitToGemini();
        showChatbot();
        if (currentFailedQuestion) {
            geminiInput.value = currentFailedQuestion;
            // Immediately submit the form
            geminiForm.dispatchEvent(new Event('submit'));
        }
    });
    
    // Upload file button
    uploadFileBtn.addEventListener('click', function() {
        hideNoMatchAlert();
        document.getElementById('fileAttachment').click();
    });
    
    // Chatbot trigger
    chatbotTrigger.addEventListener('click', function() {
        showChatbot();
    });
    
    // Chatbot close
    chatbotClose.addEventListener('click', function() {
        hideChatbot();
    });
    
    // Show/hide chatbot
    function showChatbot() {
        chatbotWindow.style.display = 'flex';
        chatbotTrigger.style.display = 'none';
        geminiInput.focus();
    }
    
    function hideChatbot() {
        chatbotWindow.style.display = 'none';
        chatbotTrigger.style.display = 'flex';
    }
    
    // Enhanced Gemini form submission with better formatting
    geminiForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const message = geminiInput.value.trim();
        if (!message) return;
        
        // Add user message
        addGeminiMessage(message, 'user');
        geminiInput.value = '';
        
        // Add loading message with better animation
        const loadingId = 'loading-' + Date.now();
        addGeminiMessage('ü§ñ Analyzing your question...', 'ai', loadingId);
        
        // Send to Gemini
        fetch('/chat-gemini', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: `message=${encodeURIComponent(message)}`
        })
        .then(response => response.json())
        .then(data => {
            // Remove loading message
            const loadingMsg = document.getElementById(loadingId);
            if (loadingMsg) loadingMsg.remove();
            
            if (data.success) {
                // Format and add the response
                addFormattedGeminiMessage(data.response, 'ai');
            } else {
                addGeminiMessage('‚ùå Sorry, I encountered an error: ' + (data.error || 'Gemini API not available'), 'ai');
            }
        })
        .catch(error => {
            // Remove loading message
            const loadingMsg = document.getElementById(loadingId);
            if (loadingMsg) loadingMsg.remove();
            
            addGeminiMessage('‚ùå Sorry, I encountered a connection error. Please try again.', 'ai');
        });
    });
    
    // Add message to Gemini chat with basic formatting
    function addGeminiMessage(text, type, id = null) {
        const messageElement = document.createElement('div');
        messageElement.className = `gemini-message gemini-${type}-message`;
        if (id) messageElement.id = id;
        messageElement.textContent = text;
        
        geminiChatArea.appendChild(messageElement);
        geminiChatArea.scrollTop = geminiChatArea.scrollHeight;
    }
    
    // Add formatted message to Gemini chat with enhanced styling
    function addFormattedGeminiMessage(text, type, id = null) {
        const messageElement = document.createElement('div');
        messageElement.className = `gemini-message gemini-${type}-message formatted`;
        if (id) messageElement.id = id;
        
        // Enhanced text formatting
        let formattedText = text;
        
        // Convert **bold** to HTML
        formattedText = formattedText.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        
        // Convert *italic* to HTML
        formattedText = formattedText.replace(/\*(.*?)\*/g, '<em>$1</em>');
        
        // Convert code blocks ```code``` to HTML
        formattedText = formattedText.replace(/```([\\s\\S]*?)```/g, '<pre class="code-block"><code>$1</code></pre>');
        
        // Convert inline code `code` to HTML
        formattedText = formattedText.replace(/`([^`]+)`/g, '<code class="inline-code">$1</code>');
        
        // Convert numbered lists
        formattedText = formattedText.replace(/^\\d+\\.\\s+(.+)$/gm, '<div class="list-item numbered">$1</div>');
        
        // Convert bullet points
        formattedText = formattedText.replace(/^[-‚Ä¢]\\s+(.+)$/gm, '<div class="list-item bullet">‚Ä¢ $1</div>');
        
        // Convert line breaks to proper HTML
        formattedText = formattedText.replace(/\\n\\n/g, '</p><p>');
        formattedText = '<p>' + formattedText + '</p>';
        
        // Clean up empty paragraphs
        formattedText = formattedText.replace(/<p><\\/p>/g, '');
        
        messageElement.innerHTML = formattedText;
        
        geminiChatArea.appendChild(messageElement);
        geminiChatArea.scrollTop = geminiChatArea.scrollHeight;
        
        // Add copy functionality to code blocks
        messageElement.querySelectorAll('.code-block').forEach(block => {
            const copyBtn = document.createElement('button');
            copyBtn.className = 'copy-code-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.onclick = () => {
                navigator.clipboard.writeText(block.textContent).then(() => {
                    copyBtn.textContent = 'Copied!';
                    setTimeout(() => { copyBtn.textContent = 'Copy'; }, 2000);
                });
            };
            block.style.position = 'relative';
            block.appendChild(copyBtn);
        });
    }
    
    // Close alert when clicking backdrop
    noMatchBackdrop.addEventListener('click', function() {
        hideNoMatchAlert();
    });
    // Prevent alert from closing when clicking inside the alert
    noMatchAlert.addEventListener('click', function(e) {
        e.stopPropagation();
    });
});



// Advanced debug functionality
// Replace the debug functionality JavaScript with this:
document.addEventListener('DOMContentLoaded', function() {
    // Load questions from vickys.json for random selection
    let allQuestions = [];
    
    // Load questions directly from vickys.json and graded assignment questions
    try {
        // Wait for graded assignment questions to load, then add them
        setTimeout(() => {
            if (gradedAssignmentQuestions && Array.isArray(gradedAssignmentQuestions)) {
                gradedAssignmentQuestions.forEach(question => {
                    allQuestions.push({
                        text: question.text,
                        category: question.category,
                        source: 'GA Questions'
                    });
                });
            }
        }, 1000);
        
        // Load questions from vickys.json
        fetch('/static/vickys.json')
            .then(response => response.json()))
            .then(data => {
                data.forEach(item => {
                    if (item.question && item.file) {
                        allQuestions.push({
                            text: item.question,
                            file: item.file,
                            source: 'File Questions'
                        });
                    }
                });
                console.log(`Loaded ${allQuestions.length} questions for debug tool`);
            })
            .catch(error => {
                console.log('Could not load vickys.json:', error);
            });
            
    } catch (e) {
        console.log('Could not load questions for debug tool:', e);
    }

    // Debug functionality
    const debugBtn = document.getElementById('debugFormBtn');
    const debugExpandable = document.getElementById('debugExpandable');
    const testFormBtn = document.getElementById('testFormBtn');
    // Add this to your debug section
const testQuestionsBtn = document.createElement('button');
testQuestionsBtn.className = 'debug-action-btn secondary';
testQuestionsBtn.innerHTML = '<i class="fas fa-list"></i> Check Questions';
testQuestionsBtn.addEventListener('click', function() {
    fetch('/api/question-stats')
        .then(response => response.json())
        .then(data => {
            const message = `üìä Question Statistics:\n\n` +
                          `Total Questions: ${data.total_questions}\n` +
                          `GA Questions: ${data.ga_questions}\n` +
                          `File Questions: ${data.file_questions}\n\n` +
                          `Categories:\n` +
                          `GA1: ${data.categories.GA1}\n` +
                          `GA2: ${data.categories.GA2}\n` +
                          `GA3: ${data.categories.GA3}\n` +
                          `GA4: ${data.categories.GA4}\n` +
                          `GA5: ${data.categories.GA5}`;
            addDebugMessage(message, 'info');
        })
        .catch(error => {
            addDebugMessage(`‚ùå Error checking questions: ${error.message}`, 'error');
        });
});

// Add the button to debug actions (insert after the existing buttons)
document.querySelector('.debug-actions').appendChild(testQuestionsBtn);
    const randomQuestionBtn = document.getElementById('randomQuestionBtn');
    const clearDebugBtn = document.getElementById('clearDebugBtn');
    const debugOutput = document.getElementById('debugOutput');

    let isExpanded = false;

    // Toggle debug expandable area
    debugBtn.addEventListener('click', function() {
        isExpanded = !isExpanded;
        
        if (isExpanded) {
            debugExpandable.style.display = 'block';
            this.innerHTML = '<i class="fas fa-chevron-up"></i> Hide Debug Tools';
        } else {
            debugExpandable.style.display = 'none';
            this.innerHTML = '<i class="fas fa-search"></i> Debug Form Data';
        }
    });

    // Test form functionality
    testFormBtn.addEventListener('click', function() {
        addDebugMessage('üîç Testing form data...', 'info');
        
        const formData = new FormData();
        formData.append('question', 'Test question from debug tool');
        
        fetch('/debug-form', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            const formattedData = JSON.stringify(data, null, 2);
            const message = `‚úÖ Form test successful!\n\nüìã Debug Results:`;
            addDebugMessage(message, 'success');
            addDebugMessage(`<pre>${formattedData}</pre>`, 'success');
        })
        .catch(error => {
            addDebugMessage(`‚ùå Form test failed!\n\nüö® Error: ${error.message}`, 'error');
        });
    });

    // Random question functionality
    randomQuestionBtn.addEventListener('click', function() {
        if (allQuestions.length === 0) {
            addDebugMessage('üìù Loading questions... Please wait and try again in a moment.', 'info');
            return;
        }
        
        // Get random question
        const randomIndex = Math.floor(Math.random() * allQuestions.length);
        const randomQuestion = allQuestions[randomIndex];
        
        // Display the question
        let questionText = `üé≤ Random Question from ${randomQuestion.source}:"${randomQuestion.text}"`;
        
        if (randomQuestion.category) {
            questionText += `\\n\\nCategory: ${randomQuestion.category}`;
        }
        
        if (randomQuestion.file) {
            questionText += `\\n\\nFile: ${randomQuestion.file}`;
        }
        
        addDebugMessage(questionText, 'question');
        
        // Auto-fill the main question input
        const questionInput = document.getElementById('questionInput');
        if (questionInput) {
            questionInput.value = randomQuestion.text;
            questionInput.focus();
        }
    });

    // Clear debug output
    clearDebugBtn.addEventListener('click', function() {
        debugOutput.innerHTML = `
            <div class="debug-message">
                Debug output cleared. Available questions: ${allQuestions.length}
            </div>
        `;
    });

    // Add message to debug output
    function addDebugMessage(text, type = 'info') {
        const messageElement = document.createElement('div');
        messageElement.className = `debug-message ${type}`;
        
        // Handle HTML content vs plain text
        if (text.includes('<pre>') || text.includes('<code>')) {
            messageElement.innerHTML = text;
        } else {
            messageElement.textContent = text;
        }
        
        debugOutput.appendChild(messageElement);
        debugOutput.scrollTop = debugOutput.scrollHeight;
    }
});
</script>
    
</div>
</body>
</html>